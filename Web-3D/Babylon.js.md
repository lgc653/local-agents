# Babylon.js

## Babylon.js çš„å†å²å’Œç‰¹ç‚¹

Babylon.js æ˜¯ä¸€ä¸ªå¼€æºçš„ WebGL æ¸¸æˆå¼•æ“ï¼Œå…·æœ‰ä»¥ä¸‹çš„å†å²å’Œç‰¹ç‚¹ï¼š

å†å²ï¼š

- Babylon.js äº2013å¹´é¦–æ¬¡å‘å¸ƒï¼Œç”± David Catuhe åˆ›å»ºã€‚
- å®ƒæœ€åˆæ˜¯ä¸ºäº†è§£å†³åˆ›å»ºåŸºäº Web çš„æ¸¸æˆå’Œäº¤äº’å¼åº”ç”¨ç¨‹åºçš„éœ€æ±‚è€Œå¼€å‘çš„ã€‚
- è‡ªå‘å¸ƒä»¥æ¥ï¼ŒBabylon.js ç»è¿‡æŒç»­çš„å‘å±•å’Œæ›´æ–°ï¼Œæˆä¸ºä¸€æ¬¾åŠŸèƒ½å¼ºå¤§ä¸”å—æ¬¢è¿çš„ WebGL å¼•æ“ã€‚

ç‰¹ç‚¹ï¼š

1. è½»é‡çº§å’Œå¿«é€Ÿï¼šBabylon.js çš„ä»£ç åº“ç›¸å¯¹è¾ƒå°ï¼Œå¹¶ä¸”è¢«ä¼˜åŒ–ä»¥æä¾›é«˜æ€§èƒ½çš„æ¸²æŸ“ã€‚å®ƒä½¿ç”¨äº†ç°ä»£çš„ Web æŠ€æœ¯å’Œ GPU åŠ é€Ÿï¼Œèƒ½å¤Ÿåœ¨ç°ä»£æµè§ˆå™¨ä¸Šå®ç°æµç•…çš„æ¸²æŸ“æ•ˆæœã€‚
2. å¼ºå¤§çš„æ¸²æŸ“èƒ½åŠ›ï¼šBabylon.js æä¾›äº†ä¸°å¯Œçš„æ¸²æŸ“åŠŸèƒ½å’Œæ•ˆæœï¼Œå¦‚é˜´å½±ã€åå°„ã€æŠ—é”¯é½¿ç­‰ã€‚å®ƒæ”¯æŒ PBRï¼ˆPhysically Based Renderingï¼‰æè´¨ï¼Œä½¿å¾—æ¸²æŸ“æ•ˆæœæ›´åŠ çœŸå®ã€‚
3. ç‰©ç†å¼•æ“é›†æˆï¼šBabylon.js å†…ç½®äº†å¼ºå¤§çš„ç‰©ç†å¼•æ“ï¼Œå¯ä»¥æ¨¡æ‹Ÿç‰©ä½“çš„è¿åŠ¨ã€é‡åŠ›ã€ç¢°æ’ç­‰ç‰©ç†è¡Œä¸ºã€‚è¿™ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿè½»æ¾åˆ›å»ºå…·æœ‰çœŸå®ç‰©ç†æ•ˆæœçš„äº¤äº’å¼åœºæ™¯ã€‚
4. å¤šå¹³å°æ”¯æŒï¼šBabylon.js å¯ä»¥åœ¨å„ç§å¹³å°ä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬æ¡Œé¢æµè§ˆå™¨ã€ç§»åŠ¨è®¾å¤‡å’Œ VR/AR è®¾å¤‡ã€‚å®ƒæ”¯æŒå¤šç§æµè§ˆå™¨ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„é€‚é…å’Œå…¼å®¹æ€§ã€‚
5. å¤§å‹åœºæ™¯å’Œå¤æ‚æ¨¡å‹å¤„ç†ï¼šBabylon.js å…·æœ‰å¤„ç†å¤§å‹åœºæ™¯å’Œå¤æ‚æ¨¡å‹çš„èƒ½åŠ›ã€‚å®ƒæ”¯æŒåœºæ™¯åˆ†å±‚å’Œå»¶è¿Ÿæ¸²æŸ“ç­‰æŠ€æœ¯ï¼Œä»¥æé«˜æ€§èƒ½å¹¶ä¿æŒæµç•…çš„ç”¨æˆ·ä½“éªŒã€‚
6. ç¤¾åŒºå’Œæ–‡æ¡£æ”¯æŒï¼šBabylon.js æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºï¼Œæä¾›äº†å¹¿æ³›çš„æ–‡æ¡£ã€ç¤ºä¾‹å’Œæ•™ç¨‹ã€‚å¼€å‘è€…å¯ä»¥ä»ç¤¾åŒºä¸­è·å–å¸®åŠ©ã€åˆ†äº«ç»éªŒå’Œå‚ä¸è®¨è®ºã€‚

æ€»çš„æ¥è¯´ï¼ŒBabylon.js æ˜¯ä¸€ä¸ªåŠŸèƒ½å…¨é¢ã€æ˜“äºå­¦ä¹ å’Œä½¿ç”¨çš„ WebGL å¼•æ“ã€‚å®ƒé€‚ç”¨äºåˆ›å»ºæ¸¸æˆã€å¯è§†åŒ–åº”ç”¨ã€AR/VR ä½“éªŒç­‰å„ç§ç±»å‹çš„äº¤äº’å¼ Web åº”ç”¨ç¨‹åºã€‚

## Babylonå®˜æ–¹å·¥å…·ç®€ä»‹

åˆ©ç”¨Babylonå®˜æ–¹æä¾›çš„å‡ æ¬¾å·¥å…·ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç”¨æœ€å°‘çš„ä»£ä»·å®Œç¾å¤ç°å‡ºç¾æœ¯ç»™è¿‡æ¥çš„æ¨¡å‹ï¼Œæ•´ä¸ªå¤ç°è¿‡ç¨‹ä¸éœ€è¦æ·»åŠ ä»»ä½•é¢å¤–çš„å…¼å®¹ä»£ç ï¼ŒçœŸæ­£åšåˆ°ç¾æœ¯å’Œç¨‹åºåœ¨ç”»é¢è¡¨ç°ä¸Šçš„ç»Ÿä¸€ã€‚

### Sandboxï¼ˆç¾æœ¯å’Œç¨‹åºéƒ½å¯ä»¥ä½¿ç”¨ï¼‰

Sandboxç”¨äºé¢„è§ˆæ¨¡å‹ï¼Œå¯ä»¥å°†3Dæ¨¡å‹ç›´æ¥æ‹–åˆ°Sandboxä¸­é¢„è§ˆæ¨¡å‹çš„æ•ˆæœï¼Œåœ¨ç¨‹åºä¸å¯¹æ¨¡å‹å±æ€§åšåŠ¨æ€ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œåœ¨Sandboxä¸­çœ‹åˆ°çš„æ•ˆæœå°±åŸºæœ¬ä¸Šæ˜¯é¡¹ç›®å‘å¸ƒåçš„å®é™…æ•ˆæœã€‚

Sandboxæ”¯æŒgltfã€glbã€objå’Œbabylonç­‰æ ¼å¼çš„3Dæ–‡ä»¶ã€‚

![img](Babylon.js.assets/0.png)

Sandboxåœ°å€ï¼š[https://sandbox.babylonjs.com](https://sandbox.babylonjs.com/)

ç‚¹å‡»Sandboxå³ä¸‹è§’çš„ç¼–è¾‘æŒ‰é’®è¿˜å¯ä»¥ä»¥å¯è§†åŒ–çš„æ–¹å¼è°ƒæ•´æ¨¡å‹çš„éƒ¨åˆ†å±æ€§ï¼Œæ”¹å˜ä»»ä½•å±æ€§æ¨¡å‹æ•ˆæœéƒ½ä¼šå®æ—¶è·Ÿç€å˜åŒ–ï¼Œé¿å…äº†ç¨‹åºâ€œç›²è°ƒâ€æ•ˆæœçš„æ—¶é—´é£é™©ï¼Œéå¸¸é€‚åˆç¾æœ¯è®¾è®¡å¸ˆå’Œç¨‹åºå‘˜åœ¨æ²Ÿé€šé¡¹ç›®æ•ˆæœæ—¶ä½¿ç”¨ã€‚

### Playgroundï¼ˆä¸»è¦ä¾›ç¨‹åºå‘˜ä½¿ç”¨ï¼‰

Playgroundæ˜¯åˆ¶ä½œæˆ–æµ‹è¯•åœºæ™¯æœ€å¿«æ·ã€æœ€ç®€å•çš„åœ°æ–¹ï¼Œç¨‹åºå‘˜å¯ä»¥åœ¨è¿™é‡Œä»¥ä»£ç æ–¹å¼åšå‡ºä¸€ä¸ªåœºæ™¯ï¼Œè§‰å¾—æ»¡æ„åå†å°†ç›¸å…³ä»£ç ç”¨åˆ°é¡¹ç›®ä¸Šã€‚ä½¿ç”¨Playgroundå¯ä»¥åœ¨ä¸€ä¸ªâ€œå¹²å‡€â€çš„ç¯å¢ƒä¸­æµ‹è¯•æ¨¡å‹æ•ˆæœï¼ŒåŒæ—¶ä¹Ÿæ˜¯å­¦ä¹ å’Œä½“éªŒBabylon API åŠŸèƒ½çš„æä½³åœºæ‰€ã€‚è€Œä¸”ä¹Ÿæ— éœ€æ­å»ºå’Œé…ç½®é¡¹ç›®ç¯å¢ƒï¼Œæ‰“å¼€å³å¯ç›´æ¥ä½¿ç”¨Babylonçš„å„ç§ API äº†ã€‚

![img](Babylon.js.assets/0-1701919673003-3.png)

Playgroundåœ°å€ï¼š[https://www.babylonjs-playground.com](https://www.babylonjs-playground.com/)

åœ¨Playgroundä¸­åˆ›å»ºä¸€ä¸ª3Dåœºæ™¯çš„å†™æ³•æ˜¯å›ºå®šçš„ï¼Œå°†æƒ³è¦æµ‹è¯•çš„ä»£ç å†™åˆ° createScene åŒ…ä½“ä¸­å°±è¡Œï¼Œä»£ç ç‰‡æ®µè¿˜å¯ä»¥ä¿å­˜å¹¶åˆ†äº«ç»™å…¶ä»–äººæŸ¥çœ‹å’Œä¸‹è½½ã€‚

### Editorï¼ˆä¸»è¦ä¾›ç¾æœ¯ä½¿ç”¨ï¼‰

Editoræ˜¯Babylonçš„æ¨¡å‹ç¼–è¾‘å™¨ï¼Œç¾æœ¯è®¾è®¡å¸ˆå¯ä»¥å°†åœ¨åˆ«çš„ IDEï¼ˆå¦‚ 3DS Maxã€Mayaã€Sketchfabï¼‰ä¸­åˆ¶ä½œçš„3Dæ¨¡å‹å¯¼å…¥Editorä¸­ç»§ç»­ç¼–è¾‘ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨Editorä»é›¶å¼€å§‹åˆ¶ä½œæ¨¡å‹ã€‚

Editorä¹Ÿæ˜¯ä¸€ä¸ªå°†åˆ«çš„æ¨¡å‹æ–‡ä»¶è½¬ä¸º.babylonæ¨¡å‹æ–‡ä»¶çš„å¥½å·¥å…·ï¼Œå¦‚æœæ¨¡å‹æ˜¯ç”±åˆ«çš„IDEæ‰€åˆ›ä½œï¼Œå¹¶æƒ³å°†è¿™äº›æ¨¡å‹ç”¨åˆ°Babylonå¼•æ“ä¸­ï¼Œå¼ºçƒˆå»ºè®®å…ˆå°†è¿™äº›æ¨¡å‹å¯¼å…¥Editorï¼Œç¡®è®¤æ¨¡å‹æ•ˆæœåå†é€šè¿‡Editorå¯¼å‡ºæ¨¡å‹æ–‡ä»¶ç»™ç¨‹åºå‘˜ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§å‡å°‘ä¸åŒæ¨¡å‹æ–‡ä»¶æ ¼å¼åœ¨Babylonå¼•æ“ä¸­çš„ä¸å…¼å®¹æ€§ã€‚

![img](Babylon.js.assets/0-1701919747645-6.png)

Editor åœ°å€ï¼šhttp://editor.babylonjs.com/

### ä¸»è¦ç±»åº“

#### æ ¸å¿ƒåº“ã€€ã€€

* BabylonJSä¸»ç¨‹åºè„šæœ¬ï¼šhttps://cdn.babylonjs.com/babylon.js
* BabylonJSçš„æœªå‹ç¼©ç‰ˆï¼šhttps://cdn.babylonjs.com/babylon.max.js

#### åŠ è½½å™¨

* æ¨¡å‹åŠ è½½ä½¿ç”¨è¿™ä¸ªå°±å¯ä»¥æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚äº†ï¼šhttps://preview.babylonjs.com/loaders/babylonjs.loaders.min.
* æ›´å¤šçš„æ¨¡å‹åŠ è½½å™¨å¯ä»¥åœ¨è¿™é‡Œå¯»æ‰¾ï¼šhttps://github.com/BabylonJS/Babylon.js/tree/master/dist/loaders

### å…¶ä»–å·¥å…·ç±»

Babylon.js æä¾›ï¼šInspectorã€Materialsã€PostProcessesã€GUIã€Procedural Texturesã€Serializers ç­‰ç±»åº“ï¼Œè¯¦è§ï¼šhttps://doc.babylonjs.com/babylon101/how_to_get

## å®‰è£…å’Œè®¾ç½®

### ä¸‹è½½å’Œå®‰è£… Babylon.js

å®‰è£…å’Œè®¾ç½® Babylon.js å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š

1. ä¸‹è½½ Babylon.jsï¼šä½ å¯ä»¥ä» Babylon.js çš„å®˜æ–¹ç½‘ç«™ï¼ˆhttps://www.babylonjs.com/ï¼‰ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ Babylon.jsã€‚ä¸‹è½½å®Œæˆåï¼Œä½ å¯ä»¥å°† Babylon.js çš„æ–‡ä»¶ä¿å­˜åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­ã€‚

2. åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹ï¼šåœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾ä½ çš„é¡¹ç›®æ–‡ä»¶ã€‚

3. å¼•å…¥ Babylon.jsï¼šåœ¨ä½ çš„ HTML æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ `<script>` æ ‡ç­¾å¼•å…¥ Babylon.js çš„åº“æ–‡ä»¶ã€‚ä½ å¯ä»¥åœ¨ `<head>` æ ‡ç­¾ä¸­å¼•å…¥å®ƒï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```html
<head>
  <script src="path/to/babylon.js"></script>
</head>
```

ç¡®ä¿ `path/to/babylon.js` æ˜¯ä½ å®é™…ä¿å­˜ Babylon.js æ–‡ä»¶çš„è·¯å¾„ã€‚

4. åˆ›å»ºç”»å¸ƒï¼šåœ¨ä½ çš„ HTML æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª `<canvas>` å…ƒç´ ï¼Œç”¨äºæ¸²æŸ“ Babylon.js çš„åœºæ™¯ã€‚ç»™è¯¥å…ƒç´ ä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œä»¥ä¾¿åç»­åœ¨ JavaScript ä»£ç ä¸­å¼•ç”¨å®ƒã€‚ä¾‹å¦‚ï¼š

```html
<body>
  <canvas id="renderCanvas"></canvas>
</body>
```

5. ç¼–å†™ JavaScript ä»£ç ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ JavaScript æ–‡ä»¶ï¼Œç”¨äºç¼–å†™ Babylon.js çš„é€»è¾‘ä»£ç ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡è·å– `<canvas>` å…ƒç´ çš„ IDï¼Œåˆ›å»ºæ¸²æŸ“å¼•æ“å’Œåœºæ™¯å¯¹è±¡ç­‰ã€‚ä¾‹å¦‚ï¼š

```javascript
// è·å– canvas å…ƒç´ 
var canvas = document.getElementById("renderCanvas");

// åˆ›å»ºæ¸²æŸ“å¼•æ“
var engine = new BABYLON.Engine(canvas, true);

// åˆ›å»ºåœºæ™¯
var scene = new BABYLON.Scene(engine);

// æ·»åŠ ç›¸æœºã€å…‰æºå’Œå…¶ä»–å¯¹è±¡åˆ°åœºæ™¯ä¸­
// ...

// æ¸²æŸ“åœºæ™¯
engine.runRenderLoop(function() {
  scene.render();
});

// å¤„ç†çª—å£å¤§å°å˜åŒ–äº‹ä»¶
window.addEventListener("resize", function() {
  engine.resize();
});
```

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥åœ¨ JavaScript ä»£ç ä¸­æ·»åŠ ç›¸æœºã€å…‰æºã€æ¨¡å‹ã€æè´¨ç­‰å…¶ä»–å¯¹è±¡ï¼Œå¹¶å®ç°äº¤äº’ã€åŠ¨ç”»ç­‰åŠŸèƒ½ã€‚

6. è¿è¡Œé¡¹ç›®ï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ä½ çš„ HTML æ–‡ä»¶ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ° Babylon.js æ¸²æŸ“çš„ç”»é¢äº†ã€‚

ä»¥ä¸Šæ˜¯ä¸€ä¸ªç®€å•çš„ Babylon.js å®‰è£…å’Œè®¾ç½®çš„æ­¥éª¤ã€‚ä½ å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å’Œé¡¹ç›®è¦æ±‚ï¼Œè¿›ä¸€æ­¥é…ç½®å’Œæ‰©å±•ä½ çš„ Babylon.js åº”ç”¨ç¨‹åºã€‚

> ä»¥ä¸‹æ¡ˆä¾‹å‡åŸºäºBabylon.js V6

[Babylon.js Sandbox - View glTF, glb, obj and babylon files (babylonjs.com)](https://sandbox.babylonjs.com/)

### è®¾ç½®é¡¹ç›®ç¯å¢ƒå’Œå¼€å‘å·¥å…·

åœ¨è®¾ç½® Babylon.js é¡¹ç›®ç¯å¢ƒå’Œé€‰æ‹©å¼€å‘å·¥å…·æ—¶ï¼Œä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ­¥éª¤å’Œå·¥å…·ï¼š

1. é€‰æ‹©å¼€å‘å·¥å…·ï¼šåœ¨ Babylon.js çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨å„ç§å¼€å‘å·¥å…·æ¥æé«˜æ•ˆç‡å’Œå¼€å‘ä½“éªŒã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å¼€å‘å·¥å…·ï¼š

   - ä»£ç ç¼–è¾‘å™¨ï¼šä¾‹å¦‚ Visual Studio Codeã€Sublime Textã€Atom ç­‰ï¼Œå®ƒä»¬æä¾›äº†è¯­æ³•é«˜äº®ã€ä»£ç è‡ªåŠ¨å®Œæˆå’Œè°ƒè¯•åŠŸèƒ½ç­‰ï¼Œä½¿å¾—ç¼–å†™ä»£ç æ›´åŠ ä¾¿æ·ã€‚

   - æµè§ˆå™¨å¼€å‘å·¥å…·ï¼šç°ä»£æµè§ˆå™¨éƒ½æä¾›äº†å¼ºå¤§çš„å¼€å‘è€…å·¥å…·ï¼Œå¦‚ Chrome çš„å¼€å‘è€…å·¥å…·ã€Firefox çš„å¼€å‘è€…å·¥å…·ç­‰ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ è°ƒè¯•ä»£ç ã€ç›‘è§†æ€§èƒ½å’Œåˆ†ææ¸²æŸ“ã€‚

   - ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·å¦‚ Gitï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†ä»£ç å’Œå›¢é˜Ÿåä½œã€‚


2. è®¾ç½®é¡¹ç›®ç»“æ„ï¼šåœ¨ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®éœ€æ±‚è®¾ç½®åˆç†çš„é¡¹ç›®ç»“æ„ï¼Œå°† Babylon.js ç›¸å…³çš„æ–‡ä»¶å’Œèµ„æºç»„ç»‡èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥å°† Babylon.js çš„åº“æ–‡ä»¶ã€æ¨¡å‹æ–‡ä»¶ã€çº¹ç†æ–‡ä»¶ç­‰æ”¾åœ¨ç›¸åº”çš„æ–‡ä»¶å¤¹ä¸­ï¼Œä»¥æ–¹ä¾¿ç®¡ç†å’Œç»´æŠ¤ã€‚

3. ä½¿ç”¨æ¨¡å—åŒ–å¼€å‘ï¼šè€ƒè™‘ä½¿ç”¨æ¨¡å—åŒ–å¼€å‘çš„æ–¹å¼ï¼Œå°† Babylon.js çš„é€»è¾‘ä»£ç åˆ†æˆå¤šä¸ªæ¨¡å—ï¼Œä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¤ç”¨æ€§ã€‚ä½ å¯ä»¥ä½¿ç”¨æ¨¡å—åŒ–å¼€å‘å·¥å…·å¦‚ Webpackã€Parcel ç­‰ï¼Œæ¥æ‰“åŒ…å’Œç®¡ç†ä½ çš„ Babylon.js ä»£ç ã€‚

4. å¼•å…¥å…¶ä»–åº“æˆ–æ¡†æ¶ï¼šåœ¨ Babylon.js é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦å¼•å…¥å…¶ä»–åº“æˆ–æ¡†æ¶æ¥è¾…åŠ©å¼€å‘ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ jQueryã€Reactã€Vue.js ç­‰æ¥å¤„ç†ç”¨æˆ·äº¤äº’ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ•°å­¦åº“ã€ç‰©ç†å¼•æ“ç­‰æ¥æ‰©å±• Babylon.js çš„åŠŸèƒ½ã€‚

5. äº†è§£å®˜æ–¹æ–‡æ¡£å’Œç¤ºä¾‹ï¼šBabylon.js å®˜æ–¹ç½‘ç«™æä¾›äº†ä¸°å¯Œçš„æ–‡æ¡£ã€æ•™ç¨‹å’Œç¤ºä¾‹ï¼Œä½ å¯ä»¥å‚è€ƒå®ƒä»¬æ¥å­¦ä¹ å’Œäº†è§£ Babylon.js çš„å„ç§ç‰¹æ€§å’Œç”¨æ³•ã€‚å®˜æ–¹æ–‡æ¡£ä¸­è¿˜åŒ…å«äº†ä¸€äº›ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå…¥é—¨å’Œç†è§£ Babylon.js çš„åŸºæœ¬æ¦‚å¿µã€‚

é€šè¿‡é€‰æ‹©åˆé€‚çš„å¼€å‘å·¥å…·ã€è®¾ç½®è‰¯å¥½çš„é¡¹ç›®ç»“æ„å’Œå……åˆ†åˆ©ç”¨å®˜æ–¹èµ„æºï¼Œä½ å¯ä»¥æ›´é«˜æ•ˆåœ°è¿›è¡Œ Babylon.js å¼€å‘ï¼Œå¹¶ä¸”æœ‰åŠ©äºç»„ç»‡å’Œç®¡ç†ä½ çš„ä»£ç ã€‚

### é…å¥—å·¥å…·

Babylon.js æä¾›äº†ä¸€äº›é…å¥—å·¥å…·ï¼Œä»¥å¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ä½¿ç”¨å’Œæ‰©å±• Babylon.jsï¼š

1. Babylon.js Playgroundï¼šè¿™æ˜¯ä¸€ä¸ªåœ¨çº¿çš„ä»£ç ç¼–è¾‘å’Œè¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è®©ä½ åœ¨æµè§ˆå™¨ä¸­å¿«é€Ÿå°è¯•å’Œæµ‹è¯• Babylon.js çš„åŠŸèƒ½å’Œç‰¹æ€§ã€‚ä½ å¯ä»¥åœ¨ Playground ä¸­ç¼–å†™å’Œè°ƒè¯•ä»£ç ï¼Œå¹¶ç«‹å³çœ‹åˆ°ç»“æœã€‚Playground è¿˜æä¾›äº†è®¸å¤šç¤ºä¾‹å’Œæ¨¡æ¿ï¼Œå¸®åŠ©ä½ å­¦ä¹ å’Œç†è§£ä¸åŒçš„ Babylon.js åŠŸèƒ½ã€‚
2. Babylon.js Inspectorï¼šè¿™æ˜¯ä¸€ä¸ªæµè§ˆå™¨æ’ä»¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è°ƒè¯•å’Œåˆ†æ Babylon.js åœºæ™¯å’Œå¯¹è±¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç•Œé¢ï¼Œå¯ä»¥æŸ¥çœ‹å’Œä¿®æ”¹åœºæ™¯ä¸­çš„å¯¹è±¡å±æ€§ã€æè´¨ã€å…‰æºã€åŠ¨ç”»ç­‰ã€‚Inspector è¿˜æ”¯æŒæ€§èƒ½åˆ†æå’Œæ¸²æŸ“ç»Ÿè®¡ï¼Œå¸®åŠ©ä½ ä¼˜åŒ–å’Œè°ƒè¯• Babylon.js åº”ç”¨ç¨‹åºã€‚
3. Babylon.js Exportersï¼šBabylon.js æä¾›äº†å¤šç§å¯¼å‡ºå·¥å…·å’Œæ’ä»¶ï¼Œç”¨äºå°†åœºæ™¯å’Œæ¨¡å‹ä»å…¶ä»–å»ºæ¨¡è½¯ä»¶ï¼ˆå¦‚ Blenderã€3ds Maxã€Maya ç­‰ï¼‰å¯¼å‡ºä¸º Babylon.js å¯ä»¥ç›´æ¥ä½¿ç”¨çš„æ ¼å¼ã€‚è¿™äº›å¯¼å‡ºå·¥å…·å¯ä»¥å¸®åŠ©ä½ å°†å¤–éƒ¨èµ„æºé›†æˆåˆ° Babylon.js é¡¹ç›®ä¸­ï¼ŒèŠ‚çœå¼€å‘æ—¶é—´ã€‚
4. Babylon.js Editorï¼šè¿™æ˜¯ä¸€ä¸ªå¯è§†åŒ–çš„ç¼–è¾‘å™¨ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ›å»ºå’Œç¼–è¾‘ Babylon.js åœºæ™¯ã€‚å®ƒæä¾›äº†å¯è§†åŒ–çš„ç•Œé¢å’Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ·»åŠ å’Œç®¡ç†åœºæ™¯ä¸­çš„å¯¹è±¡ã€å…‰æºã€æè´¨ç­‰ã€‚Editor è¿˜æ”¯æŒç‰©ç†å¼•æ“ã€åŠ¨ç”»ç¼–è¾‘å’Œé¢„è§ˆç­‰åŠŸèƒ½ï¼Œç®€åŒ–äº†åœºæ™¯æ­å»ºå’Œç¼–è¾‘çš„è¿‡ç¨‹ã€‚
5. Babylon.js Extensionsï¼šBabylon.js ç¤¾åŒºæä¾›äº†è®¸å¤šæ‰©å±•åº“å’Œå·¥å…·ï¼Œç”¨äºå¢å¼ºå’Œæ‰©å±• Babylon.js çš„åŠŸèƒ½ã€‚è¿™äº›æ‰©å±•åŒ…æ‹¬ç‰¹æ•ˆåº“ã€ç‰©ç†å¼•æ“ã€å·¥å…·åº“ç­‰ï¼Œå¯ä»¥å¸®åŠ©ä½ å®ç°æ›´å¤æ‚å’Œä¸°å¯Œçš„åœºæ™¯æ•ˆæœã€‚

ä»¥ä¸Šæ˜¯ä¸€äº› Babylon.js çš„é…å¥—å·¥å…·å’Œèµ„æºï¼Œå®ƒä»¬å¯ä»¥æä¾›æ›´å¤šçš„åŠŸèƒ½å’Œä¾¿åˆ©æ€§ï¼Œå¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°å¼€å‘å’Œè°ƒè¯• Babylon.js åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©ä½¿ç”¨è¿™äº›å·¥å…·ï¼Œå¹¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­å……åˆ†åˆ©ç”¨å®ƒä»¬ã€‚

## åˆ›å»ºåœºæ™¯å’Œå¯¹è±¡

ä½¿ç”¨Babylon.jsåˆ›å»ºåœºæ™¯å’Œå¯¹è±¡ä¸€èˆ¬é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®Œæˆ

- å¼•å…¥babylon.js
- åˆ›å»ºä¸€ä¸ªåŸºæœ¬çš„æ¸²æŸ“ç¯å¢ƒå’Œç”»å¸ƒ
- åˆ›å»ºç›¸æœºã€å…‰æºå’Œåœºæ™¯
- æ·»åŠ å’Œç®¡ç†ä¸‰ç»´å¯¹è±¡

ğŸ¤–æŸ¥çœ‹å…·ä½“å®ä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åˆ›å»ºåŸºç¡€çš„æ¨¡å‹</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
        /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
        touch-action: none;
      }
    </style>
  </head>

  <body>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <canvas id="idcanvas"></canvas>
  </body>
  <script>
    // 1-è·å–canvas çš„domå¯¹è±¡
    var canvas = document.querySelector('#idcanvas')
    // 2-å®ä¾‹åŒ–3då¼•æ“
    var engine = new BABYLON.Engine(canvas, true)
    // 3-åˆ›å»ºåœºæ™¯å¹¶è¿”å›åœºæ™¯å¯¹è±¡
    var createScene = function () {
      // 3-1 åˆ›å»ºåœºæ™¯å¯¹è±¡---(æŠŠå®ä¾‹åŒ–3då¼•æ“æ”¾å…¥é‡Œè¾¹)
      var scene = new BABYLON.Scene(engine)
      // 3-2 åˆ›å»ºç›¸æœº(FreeCamera)ï¼Œå¹¶æŠŠç›¸æœºä½ç½®è®¾ç½®åˆ°(x:0,y:5,z:-10)  new BABYLON.Vector3(x, y, z)çš„å¯¹è±¡æ¥è¡¨ç¤ºæ¨¡å‹ç½‘æ ¼çš„ä½ç½®ã€æ—‹è½¬ä»¥åŠç¼©æ”¾
      var camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, 5, -10), scene)
      // 3-3 :å°†ç›¸æœºæœå‘è®¾ç½®åˆ°åŸç‚¹
      camera.setTarget(BABYLON.Vector3.Zero())
      // 3-4:ç›¸æœºäº‹ä»¶ç»‘å®šåˆ°canvaså¯¹è±¡ä¸Šé¢
      camera.attachControl(canvas, true)
      // 3-5 ï¼šåˆ›å»ºç¯å…‰ï¼Œç¯å…‰ä¸ºæ­¢è®¾ç½®åˆ° 0 1 0
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
      //  ç¯å…‰è°ƒæš—ä¸€ç‚¹  0-1èŒƒå›´ä¹‹é—´
      light.intensity = 0.7
      // 3-6 ç»˜åˆ¶ä¸€ä¸ªçƒï¼Œæ”¯æŒå…­ä¸ªé…ç½®é¡¹ åç§°, åˆ†å‰²æ®µæ•°, ç›´å¾„, æ”¾ç½®çš„åœºæ™¯, updatable,sideOrientation
      var sphere = new BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene)
      //  è°ƒé«˜ä¸€ç‚¹
      sphere.position.y = 2
      // 3-7 åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„åœ°é¢
      var myGround = BABYLON.MeshBuilder.CreateGround('myGround', { width: 6, height: 4, subdivisions: 4 }, scene)
      // 3-8 è¿”å›åœºæ™¯
      return scene
    }
    // 4- è·å–åˆ°åˆ›å»ºçš„åœºæ™¯
    var scene = createScene()
    // 4-1 å¾ªç¯æ¸²æŸ“ï¼Œæ€§èƒ½æœ€å¤§æ¯ç§’60å¸§
    engine.runRenderLoop(function () {
      scene.render()
    })
    // 5- æµè§ˆå™¨å¤§å°å˜åŠ¨æ—¶,è§¦å‘å¼•æ“çš„é‡è½½çŠ¶æ€
    window.addEventListener('resize', function () {
      engine.resize()
    })
  </script>
</html>
```

![image-20231119211824403](Babylon.js.assets/image-20231119211824403.png)

## çº¹ç†å’Œæè´¨

åœ¨ Babylon.js ä¸­ï¼Œçº¹ç†å’Œæè´¨æ˜¯å®ç°é€¼çœŸæ¸²æŸ“çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚çº¹ç†æ˜¯ä¸€ç§å›¾åƒæˆ–å›¾æ¡ˆï¼Œå¯ä»¥åº”ç”¨åˆ°æ¨¡å‹çš„è¡¨é¢ä¸Šï¼Œè€Œæè´¨åˆ™å®šä¹‰äº†è¡¨é¢çš„å¤–è§‚å’Œå¦‚ä½•ä¸å…‰äº¤äº’ã€‚

åœ¨3Dæ¨¡å‹ä¸­ï¼Œ`position`ã€`normal`å’Œ`uv`æ˜¯å¸¸ç”¨çš„å±æ€§ï¼Œç”¨äºå®šä¹‰æ¨¡å‹çš„ä½ç½®ã€æ³•çº¿å’Œçº¹ç†åæ ‡ã€‚

* `position`ï¼šè¡¨ç¤ºæ¨¡å‹çš„é¡¶ç‚¹ä½ç½®ã€‚æ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸‰ç»´åæ ‡ï¼ˆxã€yã€zï¼‰ï¼Œç”¨äºç¡®å®šæ¨¡å‹çš„å½¢çŠ¶å’Œä½ç½®ã€‚
* `normal`ï¼šè¡¨ç¤ºæ¨¡å‹çš„æ³•çº¿å‘é‡ã€‚æ³•çº¿æ˜¯å‚ç›´äºæ¨¡å‹è¡¨é¢çš„å‘é‡ï¼Œç”¨äºè®¡ç®—å…‰ç…§å’Œé˜´å½±æ•ˆæœã€‚æ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€ä¸ªæ³•çº¿å‘é‡ï¼ˆnxã€nyã€nzï¼‰ï¼Œç”¨äºç¡®å®šæ¨¡å‹è¡¨é¢çš„æœå‘ã€‚
* `uv`ï¼šè¡¨ç¤ºæ¨¡å‹çš„çº¹ç†åæ ‡ã€‚çº¹ç†åæ ‡å®šä¹‰äº†åœ¨çº¹ç†å›¾åƒä¸Šçš„ä½ç½®ï¼Œç”¨äºå°†çº¹ç†æ˜ å°„åˆ°æ¨¡å‹è¡¨é¢ã€‚æ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€ä¸ªçº¹ç†åæ ‡ï¼ˆuã€vï¼‰ï¼Œç”¨äºç¡®å®šçº¹ç†çš„é‡‡æ ·ä½ç½®ã€‚

### åŠ è½½å’Œåº”ç”¨çº¹ç†

è¦åŠ è½½å’Œåº”ç”¨çº¹ç†ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. åˆ›å»ºçº¹ç†å¯¹è±¡ï¼šä½¿ç”¨ `BABYLON.Texture` æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªçº¹ç†å¯¹è±¡ï¼ŒæŒ‡å®šçº¹ç†å›¾åƒçš„è·¯å¾„æˆ–æ•°æ®ã€‚ä¾‹å¦‚ï¼š

```javascript
var texture = new BABYLON.Texture("path/to/texture.jpg", scene);
```

2. åˆ›å»ºæè´¨å¯¹è±¡ï¼šä½¿ç”¨ `BABYLON.StandardMaterial` æˆ–å…¶ä»–æè´¨ç±»çš„æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæè´¨å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š

```javascript
var material = new BABYLON.StandardMaterial("material", scene);
```

3. å°†çº¹ç†åº”ç”¨åˆ°æè´¨ï¼šå°†çº¹ç†å¯¹è±¡èµ‹å€¼ç»™æè´¨çš„ç›¸åº”å±æ€§ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ `diffuseTexture` å±æ€§å°†çº¹ç†åº”ç”¨åˆ°æè´¨çš„æ¼«åå°„è´´å›¾ä¸Šï¼š

```javascript
var material = new BABYLON.StandardMaterial("material", scene);
```

4. å°†æè´¨åº”ç”¨åˆ°æ¨¡å‹ï¼šå°†æè´¨å¯¹è±¡èµ‹å€¼ç»™æ¨¡å‹çš„ `material` å±æ€§ï¼Œä»¥å°†æè´¨åº”ç”¨åˆ°æ¨¡å‹çš„è¡¨é¢ä¸Šã€‚ä¾‹å¦‚ï¼Œå°†æè´¨åº”ç”¨åˆ°ä¸€ä¸ªçƒä½“æ¨¡å‹ï¼š

```javascript
var sphere = BABYLON.MeshBuilder.CreateSphere("sphere", { diameter: 2 }, scene);
sphere.material = material;
```

### è‡ªå®šä¹‰æè´¨å’Œç€è‰²å™¨

Babylon.js å…è®¸ä½ è‡ªå®šä¹‰æè´¨å’Œä½¿ç”¨è‡ªå®šä¹‰çš„ç€è‰²å™¨ã€‚ä½ å¯ä»¥ä½¿ç”¨ `BABYLON.ShaderMaterial` ç±»åˆ›å»ºè‡ªå®šä¹‰æè´¨ï¼Œå¹¶ä½¿ç”¨ GLSL æˆ– HLSL ç€è‰²å™¨è¯­è¨€ç¼–å†™è‡ªå®šä¹‰ç€è‰²å™¨ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æè´¨ï¼Œå¹¶ä½¿ç”¨è‡ªå®šä¹‰çš„é¡¶ç‚¹å’Œç‰‡æ®µç€è‰²å™¨ï¼š

```javascript
var customMaterial = new BABYLON.ShaderMaterial("customMaterial", scene, {
  vertex: "custom",
  fragment: "custom",
}, {
  attributes: ["position", "normal", "uv"],
  uniforms: ["worldViewProjection", "time"],
});

customMaterial.setFloat("time", 0);

// è®¾ç½®è‡ªå®šä¹‰çš„é¡¶ç‚¹å’Œç‰‡æ®µç€è‰²å™¨ä»£ç 
customMaterial.VertexShader = `
  precision highp float;
  attribute vec3 position;
  attribute vec3 normal;
  attribute vec2 uv;
  uniform mat4 worldViewProjection;
  varying vec2 vUV;
  void main(void) {
    gl_Position = worldViewProjection * vec4(position, 1.0);
    vUV = uv;
  }
`;

customMaterial.FragmentShader = `
  precision highp float;
  varying vec2 vUV;
  uniform float time;
  void main(void) {
    vec2 uv = vUV;
    // è‡ªå®šä¹‰ç€è‰²å™¨é€»è¾‘...
    gl_FragColor = vec4(uv.x, uv.y, sin(time), 1.0);
  }
`;

// å°†è‡ªå®šä¹‰æè´¨åº”ç”¨åˆ°æ¨¡å‹
var box = BABYLON.MeshBuilder.CreateBox("box", { size: 2 }, scene);
box.material = customMaterial;
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `BABYLON.ShaderMaterial` æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„æè´¨å¯¹è±¡ã€‚æˆ‘ä»¬æŒ‡å®šäº†è‡ªå®šä¹‰çš„é¡¶ç‚¹å’Œç‰‡æ®µç€è‰²å™¨ä»£ç ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºæè´¨çš„å±æ€§ã€‚ç€è‰²å™¨ä»£ç å¯ä»¥ä½¿ç”¨ GLSL æˆ– HLSL è¯­è¨€ç¼–å†™ï¼Œä½ å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å¤„ç†é¡¶ç‚¹ä½ç½®å’Œæ³•çº¿ç­‰ä¿¡æ¯ï¼Œåœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å¤„ç†å…‰ç…§ã€çº¹ç†ç­‰æ•ˆæœã€‚

å°†è‡ªå®šä¹‰æè´¨åº”ç”¨åˆ°ç‰©ä½“ï¼šå°†è‡ªå®šä¹‰æè´¨å¯¹è±¡èµ‹å€¼ç»™ç‰©ä½“çš„ `material` å±æ€§ï¼Œå°±åƒå†…ç½®æè´¨ä¸€æ ·ã€‚

### ä½¿ç”¨æè´¨å±æ€§å’Œè´´å›¾

æè´¨å±æ€§å’Œè´´å›¾å¯ä»¥ç”¨äºæ§åˆ¶ç‰©ä½“çš„å¤–è§‚å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æè´¨å±æ€§å’Œè´´å›¾çš„ç¤ºä¾‹ï¼š

- `diffuseTexture`ï¼šæ¼«åå°„çº¹ç†ï¼Œç”¨äºæ§åˆ¶ç‰©ä½“çš„åŸºæœ¬é¢œè‰²ã€‚
- `opacityTexture`ï¼šé€æ˜åº¦çº¹ç†ï¼Œç”¨äºæ§åˆ¶ç‰©ä½“çš„é€æ˜åº¦ã€‚
- `normalTexture`ï¼šæ³•çº¿è´´å›¾ï¼Œç”¨äºæ¨¡æ‹Ÿç‰©ä½“è¡¨é¢çš„å‡¹å‡¸æ•ˆæœã€‚
- `specularTexture`ï¼šé«˜å…‰

### ä¸¾ä¾‹

#### æè´¨ä¸¾ä¾‹

åœ¨åˆšæ‰çš„åŸºç¡€å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿½åŠ å¦‚ä¸‹ä»£ç 

```javascript
// åœ¨æ­¥éª¤3-6åˆ›å»ºçƒä½“åï¼Œåˆ›å»ºå¹¶è®¾ç½®æè´¨
var material = new BABYLON.StandardMaterial("material", scene);
material.diffuseColor = new BABYLON.Color3(1, 0, 0); // è®¾ç½®æ¼«åå°„é¢œè‰²ä¸ºçº¢è‰²
sphere.material = material; // åº”ç”¨æè´¨åˆ°çƒä¸Š
```

![image-20231119213903545](Babylon.js.assets/image-20231119213903545.png)

#### è´´å›¾ä¸¾ä¾‹

åœ¨åˆšæ‰çš„åŸºç¡€å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿½åŠ å¦‚ä¸‹ä»£ç ç»™çƒä½“åŠ ä¸Šå¤§ç†çŸ³æ•ˆæœçš„è´´å›¾

![marble](Babylon.js.assets/marble.jpg)

```javascript
var texture = new BABYLON.Texture("./marble.jpg", scene);
var material = new BABYLON.StandardMaterial("material", scene);
material.diffuseTexture = texture;
sphere.material = material; // åº”ç”¨æè´¨åˆ°çƒä¸Š
```

> æ³¨æ„æ–‡ä»¶å’Œå›¾ç‰‡æœ€å¥½æ˜¯åŒåŸŸwebè·¯å¾„è®¿é—®ï¼Œå¦åˆ™ä¼šblocked by CORS policy

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åˆ›å»ºåŸºç¡€çš„æ¨¡å‹</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
        /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
        touch-action: none;
      }
    </style>
  </head>

  <body>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <canvas id="idcanvas"></canvas>
  </body>
  <script>
    // 1-è·å–canvas çš„domå¯¹è±¡
    var canvas = document.querySelector('#idcanvas')
    // 2-å®ä¾‹åŒ–3då¼•æ“
    var engine = new BABYLON.Engine(canvas, true)
    // 3-åˆ›å»ºåœºæ™¯å¹¶è¿”å›åœºæ™¯å¯¹è±¡
    var createScene = function () {
      // 3-1 åˆ›å»ºåœºæ™¯å¯¹è±¡---(æŠŠå®ä¾‹åŒ–3då¼•æ“æ”¾å…¥é‡Œè¾¹)
      var scene = new BABYLON.Scene(engine)
      // 3-2 åˆ›å»ºç›¸æœº(FreeCamera)ï¼Œå¹¶æŠŠç›¸æœºä½ç½®è®¾ç½®åˆ°(x:0,y:5,z:-10)  new BABYLON.Vector3(x, y, z)çš„å¯¹è±¡æ¥è¡¨ç¤ºæ¨¡å‹ç½‘æ ¼çš„ä½ç½®ã€æ—‹è½¬ä»¥åŠç¼©æ”¾
      var camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, 5, -10), scene)
      // 3-3 :å°†ç›¸æœºæœå‘è®¾ç½®åˆ°åŸç‚¹
      camera.setTarget(BABYLON.Vector3.Zero())
      // 3-4:ç›¸æœºäº‹ä»¶ç»‘å®šåˆ°canvaså¯¹è±¡ä¸Šé¢
      camera.attachControl(canvas, true)
      // 3-5 ï¼šåˆ›å»ºç¯å…‰ï¼Œç¯å…‰ä¸ºæ­¢è®¾ç½®åˆ° 0 1 0
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
      //  ç¯å…‰è°ƒæš—ä¸€ç‚¹  0-1èŒƒå›´ä¹‹é—´
      light.intensity = 0.7
      // 3-6 ç»˜åˆ¶ä¸€ä¸ªçƒï¼Œæ”¯æŒå…­ä¸ªé…ç½®é¡¹ åç§°, åˆ†å‰²æ®µæ•°, ç›´å¾„, æ”¾ç½®çš„åœºæ™¯, updatable,sideOrientation
      var sphere = new BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene)
      //  è°ƒé«˜ä¸€ç‚¹
      sphere.position.y = 2
      var texture = new BABYLON.Texture("https://agents.uue.cn/courses/Web-3D/assets/marble.jpg", scene);
      var material = new BABYLON.StandardMaterial("material", scene);
      material.diffuseTexture = texture;
      sphere.material = material; // åº”ç”¨æè´¨åˆ°çƒä¸Š
      // 3-7 åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„åœ°é¢
      var myGround = BABYLON.MeshBuilder.CreateGround('myGround', { width: 6, height: 4, subdivisions: 4 }, scene)
      // 3-8 è¿”å›åœºæ™¯
      return scene
    }
    // 4- è·å–åˆ°åˆ›å»ºçš„åœºæ™¯
    var scene = createScene()
    // 4-1 å¾ªç¯æ¸²æŸ“ï¼Œæ€§èƒ½æœ€å¤§æ¯ç§’60å¸§
    engine.runRenderLoop(function () {
      scene.render()
    })
    // 5- æµè§ˆå™¨å¤§å°å˜åŠ¨æ—¶,è§¦å‘å¼•æ“çš„é‡è½½çŠ¶æ€
    window.addEventListener('resize', function () {
      engine.resize()
    })
  </script>
</html>
```

![image-20231119214722238](Babylon.js.assets/image-20231119214722238.png)

## åŠ¨ç”»å’Œäº¤äº’

åœ¨ Babylon.js ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºå’Œç®¡ç†åŠ¨ç”»æ¥ä½¿ä½ çš„åœºæ™¯æ›´åŠ ç”ŸåŠ¨å’Œäº’åŠ¨ã€‚ä½ è¿˜å¯ä»¥å¤„ç†ç”¨æˆ·è¾“å…¥å’Œäº¤äº’ï¼Œä»¥å®ç°åŸºæœ¬çš„ç›¸æœºå’Œå¯¹è±¡æ§åˆ¶ã€‚

### åˆ›å»ºå’Œç®¡ç†åŠ¨ç”»

è¦åˆ›å»ºåŠ¨ç”»ï¼Œä½ éœ€è¦ä½¿ç”¨ `BABYLON.Animation` ç±»ã€‚å¯ä»¥æŒ‡å®šè¦åŠ¨ç”»åŒ–çš„å±æ€§å’Œç›®æ ‡å€¼ï¼Œå¹¶è®¾ç½®åŠ¨ç”»çš„æŒç»­æ—¶é—´ã€å¾ªç¯æ¬¡æ•°å’Œç¼“åŠ¨å‡½æ•°ç­‰ã€‚

ä»¥ä¸‹æ˜¯åˆ›å»ºå’Œç®¡ç†åŠ¨ç”»çš„åŸºæœ¬æ­¥éª¤ï¼š

1. åˆ›å»ºåŠ¨ç”»å¯¹è±¡ï¼šä½¿ç”¨ `BABYLON.Animation` æ„é€ å‡½æ•°åˆ›å»ºåŠ¨ç”»å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š

```javascript
var animation = new BABYLON.Animation(
  "animationName",
  property,
  frameRate,
  dataType,
  loopMode
);
```

è¿™é‡Œçš„ `property` æ˜¯è¦åŠ¨ç”»åŒ–çš„å±æ€§ï¼Œå¦‚ä½ç½®ã€æ—‹è½¬ç­‰ã€‚`frameRate` æ˜¯åŠ¨ç”»å¸§ç‡ï¼Œ`dataType` æ˜¯å±æ€§çš„æ•°æ®ç±»å‹ï¼Œ`loopMode` æ˜¯åŠ¨ç”»å¾ªç¯æ¨¡å¼ã€‚

2. å®šä¹‰åŠ¨ç”»å¸§ï¼šä½¿ç”¨ `animation.setKeys()` æ–¹æ³•å®šä¹‰åŠ¨ç”»çš„å…³é”®å¸§ã€‚æ¯ä¸ªå…³é”®å¸§åŒ…å«æ—¶é—´å’Œå¯¹åº”çš„å±æ€§å€¼ã€‚ä¾‹å¦‚ï¼š

```javascript
animation.setKeys([
  { frame: 0, value: initialValue },
  { frame: 100, value: targetValue }
]);
```

è¿™é‡Œçš„ `frame` æ˜¯å…³é”®å¸§çš„æ—¶é—´ï¼Œ`value` æ˜¯å¯¹åº”çš„å±æ€§å€¼ã€‚

3. å°†åŠ¨ç”»åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡ï¼šä½¿ç”¨ `targetObject.animations.push()` æ–¹æ³•å°†åŠ¨ç”»å¯¹è±¡æ·»åŠ åˆ°ç›®æ ‡å¯¹è±¡çš„åŠ¨ç”»æ•°ç»„ä¸­ã€‚ä¾‹å¦‚ï¼š

```javascript
targetObject.animations.push(animation);
```

4. æ’­æ”¾åŠ¨ç”»ï¼šä½¿ç”¨åœºæ™¯çš„ `beginAnimation()` æ–¹æ³•æ’­æ”¾åŠ¨ç”»ã€‚ä¾‹å¦‚ï¼š

```javascript
scene.beginAnimation(targetObject, startFrame, endFrame, loop, speed);
```

è¿™é‡Œçš„ `targetObject` æ˜¯ç›®æ ‡å¯¹è±¡ï¼Œ`startFrame` å’Œ `endFrame` æ˜¯åŠ¨ç”»çš„èµ·å§‹å’Œç»“æŸå¸§ï¼Œ`loop` æ˜¯åŠ¨ç”»æ˜¯å¦å¾ªç¯ï¼Œ`speed` æ˜¯åŠ¨ç”»æ’­æ”¾é€Ÿåº¦ã€‚

æˆ‘ä»¬æŠŠåˆšæ‰çš„ä»£ç ç¨ä½œä¿®æ”¹ï¼Œåˆ¶ä½œä¸€ä¸ªå¤§ç†çŸ³çƒä½“å›´ç»•Yè½´360åº¦è½¬åŠ¨çš„ä¾‹å­

```javascript
// åˆ›å»ºåŠ¨ç”»
var animation = new BABYLON.Animation(
  "rotationAnimation",
  "rotation.y",
  30,
  BABYLON.Animation.ANIMATIONTYPE_FLOAT,
  BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE
);

// å®šä¹‰åŠ¨ç”»å¸§
var keys = [];
keys.push({ frame: 0, value: 0 });
keys.push({ frame: 100, value: 2 * Math.PI });
animation.setKeys(keys);

// å°†åŠ¨ç”»åº”ç”¨åˆ°çƒä½“
sphere.animations.push(animation);
scene.beginAnimation(sphere, 0, 100, true);
```

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç 

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åˆ›å»ºåŸºç¡€çš„æ¨¡å‹</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
        /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
        touch-action: none;
      }
    </style>
  </head>

  <body>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <canvas id="idcanvas"></canvas>
  </body>
  <script>
    // 1-è·å–canvas çš„domå¯¹è±¡
    var canvas = document.querySelector('#idcanvas')
    // 2-å®ä¾‹åŒ–3då¼•æ“
    var engine = new BABYLON.Engine(canvas, true)
    // 3-åˆ›å»ºåœºæ™¯å¹¶è¿”å›åœºæ™¯å¯¹è±¡
    var createScene = function () {
      // 3-1 åˆ›å»ºåœºæ™¯å¯¹è±¡---(æŠŠå®ä¾‹åŒ–3då¼•æ“æ”¾å…¥é‡Œè¾¹)
      var scene = new BABYLON.Scene(engine)
      // 3-2 åˆ›å»ºç›¸æœº(FreeCamera)ï¼Œå¹¶æŠŠç›¸æœºä½ç½®è®¾ç½®åˆ°(x:0,y:5,z:-10)  new BABYLON.Vector3(x, y, z)çš„å¯¹è±¡æ¥è¡¨ç¤ºæ¨¡å‹ç½‘æ ¼çš„ä½ç½®ã€æ—‹è½¬ä»¥åŠç¼©æ”¾
      var camera = new BABYLON.FreeCamera('camera1', new BABYLON.Vector3(0, 5, -10), scene)
      // 3-3 :å°†ç›¸æœºæœå‘è®¾ç½®åˆ°åŸç‚¹
      camera.setTarget(BABYLON.Vector3.Zero())
      // 3-4:ç›¸æœºäº‹ä»¶ç»‘å®šåˆ°canvaså¯¹è±¡ä¸Šé¢
      camera.attachControl(canvas, true)
      // 3-5 ï¼šåˆ›å»ºç¯å…‰ï¼Œç¯å…‰ä¸ºæ­¢è®¾ç½®åˆ° 0 1 0
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
      //  ç¯å…‰è°ƒæš—ä¸€ç‚¹  0-1èŒƒå›´ä¹‹é—´
      light.intensity = 0.7
      // 3-6 ç»˜åˆ¶ä¸€ä¸ªçƒï¼Œæ”¯æŒå…­ä¸ªé…ç½®é¡¹ åç§°, åˆ†å‰²æ®µæ•°, ç›´å¾„, æ”¾ç½®çš„åœºæ™¯, updatable,sideOrientation
      var sphere = new BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene)
      //  è°ƒé«˜ä¸€ç‚¹
      sphere.position.y = 2
      var texture = new BABYLON.Texture('https://agents.uue.cn/courses/Web-3D/assets/marble.jpg', scene)
      var material = new BABYLON.StandardMaterial('material', scene)
      material.diffuseTexture = texture
      sphere.material = material // åº”ç”¨æè´¨åˆ°çƒä¸Š
      // åˆ›å»ºåŠ¨ç”»
      var animation = new BABYLON.Animation(
        'rotationAnimation',
        'rotation.y',
        30,
        BABYLON.Animation.ANIMATIONTYPE_FLOAT,
        BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE
      )

      // å®šä¹‰åŠ¨ç”»å¸§
      var keys = []
      keys.push({ frame: 0, value: 0 })
      keys.push({ frame: 100, value: 2 * Math.PI })
      animation.setKeys(keys)

      // å°†åŠ¨ç”»åº”ç”¨åˆ°çƒä½“
      sphere.animations.push(animation)
      scene.beginAnimation(sphere, 0, 100, true)
      // 3-7 åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„åœ°é¢
      var myGround = BABYLON.MeshBuilder.CreateGround('myGround', { width: 6, height: 4, subdivisions: 4 }, scene)
      // 3-8 è¿”å›åœºæ™¯
      return scene
    }
    // 4- è·å–åˆ°åˆ›å»ºçš„åœºæ™¯
    var scene = createScene()
    // 4-1 å¾ªç¯æ¸²æŸ“ï¼Œæ€§èƒ½æœ€å¤§æ¯ç§’60å¸§
    engine.runRenderLoop(function () {
      scene.render()
    })
    // 5- æµè§ˆå™¨å¤§å°å˜åŠ¨æ—¶,è§¦å‘å¼•æ“çš„é‡è½½çŠ¶æ€
    window.addEventListener('resize', function () {
      engine.resize()
    })
  </script>
</html>
```

![image-20231119221331631](Babylon.js.assets/image-20231119221331631.png)

### å¤„ç†ç”¨æˆ·è¾“å…¥å’Œäº¤äº’

åœ¨ Babylon.js ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ç›‘å¬ç”¨æˆ·çš„è¾“å…¥äº‹ä»¶æ¥å¤„ç†äº¤äº’ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ç”¨æˆ·è¾“å…¥äº‹ä»¶ï¼š

- `pointerdown`ï¼šå½“ç”¨æˆ·ç‚¹å‡»é¼ æ ‡æŒ‰é’®æˆ–è§¦æ‘¸å±å¹•æ—¶è§¦å‘ã€‚
- `pointerup`ï¼šå½“ç”¨æˆ·é‡Šæ”¾é¼ æ ‡æŒ‰é’®æˆ–åœæ­¢è§¦æ‘¸å±å¹•æ—¶è§¦å‘ã€‚
- `pointermove`ï¼šå½“ç”¨æˆ·ç§»åŠ¨é¼ æ ‡æˆ–è§¦æ‘¸å±å¹•æ—¶è§¦å‘ã€‚

å¯ä»¥ä½¿ç”¨ `scene.onPointerDown`ã€`scene.onPointerUp` å’Œ `scene.onPointerMove` æ–¹æ³•æ¥ç›‘å¬è¿™äº›äº‹ä»¶ã€‚ä¾‹å¦‚ï¼š

```javascript
scene.onPointerDown = function (evt) {
  // å¤„ç†é¼ æ ‡æŒ‰ä¸‹æˆ–è§¦æ‘¸å±å¹•äº‹ä»¶
};

scene.onPointerUp = function (evt) {
  // å¤„ç†é¼ æ ‡é‡Šæ”¾æˆ–åœæ­¢è§¦æ‘¸å±å¹•äº‹ä»¶
};

scene.onPointerMove = function (evt) {
  // å¤„ç†é¼ æ ‡ç§»åŠ¨æˆ–è§¦æ‘¸å±å¹•ç§»åŠ¨äº‹ä»¶
};
```

åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­ï¼Œä½ å¯ä»¥æ ¹æ®äº‹ä»¶çš„ä¿¡æ¯æ¥æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå¦‚ç§»åŠ¨ç›¸æœºã€é€‰æ‹©ç‰©ä½“ç­‰ã€‚

### å®ç°åŸºæœ¬çš„ç›¸æœºå’Œå¯¹è±¡æ§åˆ¶

åœ¨ Babylon.js ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡æ§åˆ¶ç›¸æœºå’Œå¯¹è±¡çš„å±æ€§æ¥å®ç°åŸºæœ¬çš„ç›¸æœºå’Œå¯¹è±¡æ§åˆ¶ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„æ§åˆ¶æ–¹æ³•ï¼š

#### ç§»åŠ¨ç›¸æœº

å¯ä»¥ä½¿ç”¨ç›¸æœºçš„ `position` å±æ€§æ¥ç§»åŠ¨ç›¸æœºçš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œè¦å°†ç›¸æœºå‘å‰ç§»åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ `camera.position.z += 1;`ã€‚è¿™å°†ä½¿ç›¸æœºæ²¿ç€å…¶æœå‘çš„æ­£æ–¹å‘ç§»åŠ¨ä¸€ä¸ªå•ä½ã€‚

#### æ—‹è½¬ç›¸æœº

å¯ä»¥ä½¿ç”¨ç›¸æœºçš„ `rotation` å±æ€§æ¥æ—‹è½¬ç›¸æœºçš„æ–¹å‘ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿ç›¸æœºç»• Y è½´é€†æ—¶é’ˆæ—‹è½¬ï¼Œå¯ä»¥ä½¿ç”¨ `camera.rotation.y += Math.PI / 180;`ã€‚è¿™å°†ä½¿ç›¸æœºæœå‘é€†æ—¶é’ˆæ–¹å‘æ—‹è½¬ä¸€ä¸ªåº¦æ•°å•ä½ã€‚

#### æ§åˆ¶å¯¹è±¡

å¯ä»¥ä½¿ç”¨å¯¹è±¡çš„ä½ç½®ã€æ—‹è½¬å’Œç¼©æ”¾å±æ€§æ¥æ§åˆ¶å¯¹è±¡çš„å˜æ¢ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿å¯¹è±¡æ²¿ X è½´ç§»åŠ¨ï¼Œå¯ä»¥ä½¿ç”¨ `object.position.x += 1;`ã€‚è¦ä½¿å¯¹è±¡ç»• Y è½´æ—‹è½¬ï¼Œå¯ä»¥ä½¿ç”¨ `object.rotation.y += Math.PI / 180;`ã€‚è¦ä½¿å¯¹è±¡ç¼©æ”¾ï¼Œå¯ä»¥ä½¿ç”¨ `object.scaling.x *= 2;`ã€‚

#### å¤„ç†ç”¨æˆ·è¾“å…¥

é€šè¿‡ç»“åˆç›¸æœºå’Œå¯¹è±¡çš„æ§åˆ¶ä»¥åŠç”¨æˆ·è¾“å…¥çš„å¤„ç†ï¼Œä½ å¯ä»¥å®ç°å„ç§äº¤äº’æ•ˆæœï¼Œå¦‚ç›¸æœºæ¼«æ¸¸ã€å¯¹è±¡æ‹–æ‹½ç­‰ã€‚

è¯·æ³¨æ„ï¼Œä»¥ä¸Šåªæ˜¯ä¸€äº›åŸºæœ¬çš„ç¤ºä¾‹ä»£ç ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œé€‚å½“çš„ä¿®æ”¹å’Œæ‰©å±•ã€‚

#### å¯¹è±¡æ‹–æ‹½ä¸¾ä¾‹

è¦å®ç°å¯¹è±¡æ‹–æ‹½çš„æ•ˆæœï¼Œä½ å¯ä»¥ä½¿ç”¨ Babylon.js æä¾›çš„è¾“å…¥äº‹ä»¶æ¥ç›‘å¬é¼ æ ‡æˆ–è§¦æ‘¸å±å¹•çš„æ“ä½œï¼Œå¹¶æ ¹æ®é¼ æ ‡æˆ–è§¦æ‘¸ä½ç½®çš„å˜åŒ–æ¥æ›´æ–°å¯¹è±¡çš„ä½ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å®ç°å¯¹è±¡çš„æ‹–æ‹½æ•ˆæœï¼š

```javascript
// åˆ›å»ºåœºæ™¯å’Œç›¸æœº
var canvas = document.getElementById('idcanvas')
var engine = new BABYLON.Engine(canvas, true)
var scene = new BABYLON.Scene(engine)
var camera = new BABYLON.FreeCamera('camera', new BABYLON.Vector3(0, 0, -10), scene)
camera.setTarget(BABYLON.Vector3.Zero())
// åˆ›å»ºç¯å…‰
var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
light.intensity = 0.7
// åˆ›å»ºçƒä½“
var sphere = new BABYLON.Mesh.CreateSphere('sphere1', 16, 2, scene)
var texture = new BABYLON.Texture('./marble.jpg', scene)
var material = new BABYLON.StandardMaterial('material', scene)
material.diffuseTexture = texture
sphere.material = material // åº”ç”¨æè´¨åˆ°çƒä¸Š

// ç›‘å¬é¼ æ ‡æˆ–è§¦æ‘¸å±å¹•çš„æ“ä½œ
var isDragging = false
var startPoint = { x: 0, y: 0 }

scene.onPointerDown = function (evt) {
  isDragging = true
  startPoint.x = evt.clientX || evt.x
  startPoint.y = evt.clientY || evt.y
}

scene.onPointerUp = function (evt) {
  isDragging = false
}

scene.onPointerMove = function (evt) {
  if (isDragging) {
    var currentPoint = { x: evt.clientX || evt.x, y: evt.clientY || evt.y }
    var deltaX = currentPoint.x - startPoint.x
    var deltaY = currentPoint.y - startPoint.y

    // æ›´æ–°ç›’å­çš„ä½ç½®
    sphere.position.x += deltaX / 100
    sphere.position.y -= deltaY / 100

    startPoint = currentPoint
  }
}

// æ¸²æŸ“åœºæ™¯
engine.runRenderLoop(function () {
  scene.render()
})

// å¤„ç†çª—å£å¤§å°å˜åŒ–
window.addEventListener('resize', function () {
  engine.resize()
})
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªçƒä½“ï¼Œå¹¶ç›‘å¬é¼ æ ‡æˆ–è§¦æ‘¸å±å¹•çš„æ“ä½œã€‚å½“é¼ æ ‡æŒ‰ä¸‹æˆ–è§¦æ‘¸å±å¹•æ—¶ï¼Œæˆ‘ä»¬è®°å½•ä¸‹èµ·å§‹ç‚¹çš„ä½ç½®ï¼Œå¹¶å°† `isDragging` æ ‡å¿—è®¾ç½®ä¸º `true`ã€‚å½“é¼ æ ‡ç§»åŠ¨æˆ–è§¦æ‘¸ç‚¹ç§»åŠ¨æ—¶ï¼Œæˆ‘ä»¬è®¡ç®—å‡ºå½“å‰ç‚¹ä¸èµ·å§‹ç‚¹çš„å·®å€¼ï¼Œå¹¶å°†çƒä½“çš„ä½ç½®æ›´æ–°ä¸ºå½“å‰ä½ç½®ä¸å·®å€¼çš„æ¯”ä¾‹ã€‚æœ€åï¼Œå½“é¼ æ ‡é‡Šæ”¾æˆ–åœæ­¢è§¦æ‘¸å±å¹•æ—¶ï¼Œ

#### é¼ æ ‡æ‚¬åœé«˜äº®

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ Babylon.js çš„ä¾‹å­ï¼Œå½“é¼ æ ‡æ‚¬åœåœ¨ç‰©ä½“ä¸Šæ—¶ï¼Œç‰©ä½“ä¼šé«˜äº®æ˜¾ç¤ºï¼š

```javascript
// è·å–ç”»å¸ƒå…ƒç´ 
const canvas = document.getElementById('renderCanvas');

// åˆ›å»ºåœºæ™¯
const createScene = () => {
  const scene = new BABYLON.Scene(engine);

  // åˆ›å»ºç›¸æœº
  const camera = new BABYLON.ArcRotateCamera('camera', 0, 0, 10, BABYLON.Vector3.Zero(), scene);
  camera.setPosition(new BABYLON.Vector3(0, 0, -10));
  camera.attachControl(canvas, true);

  // åˆ›å»ºç¯å…‰
  const light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene);

  // åˆ›å»ºç‰©ä½“
  const box = BABYLON.MeshBuilder.CreateBox('box', { size: 2 }, scene);

  // åˆ›å»ºé«˜äº®æ•ˆæœ
  const highlight = new BABYLON.HighlightLayer('highlight', scene);

  // é¼ æ ‡ç§»å…¥äº‹ä»¶
  box.actionManager = new BABYLON.ActionManager(scene);
  box.actionManager.registerAction(new BABYLON.ExecuteCodeAction(
    BABYLON.ActionManager.OnPointerOverTrigger,
    () => {
      highlight.addMesh(box, BABYLON.Color3.Green());
    }
  ));

  // é¼ æ ‡ç§»å‡ºäº‹ä»¶
  box.actionManager.registerAction(new BABYLON.ExecuteCodeAction(
    BABYLON.ActionManager.OnPointerOutTrigger,
    () => {
      highlight.removeMesh(box);
    }
  ));

  return scene;
};

// åˆ›å»ºå¼•æ“
const engine = new BABYLON.Engine(canvas, true);

// åˆ›å»ºåœºæ™¯
const scene = createScene();

// æ¸²æŸ“åœºæ™¯
engine.runRenderLoop(() => {
  scene.render();
});

// è°ƒæ•´ç”»å¸ƒå¤§å°
window.addEventListener('resize', () => {
  engine.resize();
});
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåœºæ™¯ï¼Œå¹¶åœ¨åœºæ™¯ä¸­åŠ å…¥äº†ä¸€ä¸ªç«‹æ–¹ä½“ç‰©ä½“ã€‚å½“é¼ æ ‡æ‚¬åœåœ¨ç«‹æ–¹ä½“ä¸Šæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ `HighlightLayer` åˆ›å»ºäº†ä¸€ä¸ªé«˜äº®æ•ˆæœï¼Œå¹¶å°†é«˜äº®æ•ˆæœåº”ç”¨åˆ°ç«‹æ–¹ä½“ä¸Šã€‚å½“é¼ æ ‡ç¦»å¼€ç«‹æ–¹ä½“æ—¶ï¼Œæˆ‘ä»¬ç§»é™¤äº†é«˜äº®æ•ˆæœã€‚

![image-20231122215602353](Babylon.js.assets/image-20231122215602353.png)



#### é«˜äº®èšç„¦

è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ªåœºæ™¯ï¼Œå…¶ä¸­ä¸€ä¸ªçƒä½“æ”¾ç½®åœ¨ä¸€ä¸ªåœ†æŸ±ä½“ä¸Šæ–¹ã€‚Babylon.js è´Ÿè´£æ¸²æŸ“åœºæ™¯ï¼Œä½¿ç”¨é«˜äº®å±‚æ¥çªå‡ºæ˜¾ç¤ºçƒä½“ï¼Œå¹¶å°†ç›¸æœºèšç„¦åœ¨çƒä½“ä¸Šã€‚

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <title>Babylon.js Example</title>
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100%; }
    </style>
</head>
<body>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <canvas id="renderCanvas"></canvas>
    <button id="highlightButton">Highlight Sphere and Focus</button>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // åˆ›å»ºå¼•æ“
            var canvas = document.getElementById("renderCanvas");
            var engine = new BABYLON.Engine(canvas, true);

            // åˆ›å»ºåœºæ™¯
            var scene = new BABYLON.Scene(engine);

            // åˆ›å»ºç›¸æœº
            var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, Math.PI / 4, 4, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            // åˆ›å»ºå…‰æº
            var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

            // åˆ›å»ºçƒä½“
            var sphere = BABYLON.MeshBuilder.CreateSphere("sphere", { diameter: 1 }, scene);
            sphere.position.y = 1;

            // åˆ›å»ºåœ†æŸ±ä½“
            var cylinder = BABYLON.MeshBuilder.CreateCylinder("cylinder", { height: 1, diameter: 1 }, scene);
            cylinder.position.y = 0.5;

            // åˆ›å»ºé«˜äº®æ•ˆæœ
            var highlightLayer = new BABYLON.HighlightLayer("highlightLayer", scene);

            // ç‚¹å‡»æŒ‰é’®æ—¶é«˜äº®çƒä½“å¹¶èšç„¦
            var highlightButton = document.getElementById("highlightButton");
            highlightButton.addEventListener("click", function () {
                highlightLayer.addMesh(sphere, BABYLON.Color3.Yellow());

                var targetPosition = sphere.position.clone();
                var targetRadius = 2;
                var animationDuration = 2000; // 2ç§’

                var animation = new BABYLON.Animation("cameraAnimation", "radius", 60, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);
                var keys = [
                    { frame: 0, value: camera.radius },
                    { frame: 60, value: targetRadius }
                ];
                animation.setKeys(keys);

                var startTime = performance.now();
                scene.registerBeforeRender(function () {
                    var currentTime = performance.now();
                    var deltaTime = currentTime - startTime;
                    var normalizedTime = Math.min(deltaTime / animationDuration, 1);

                    var currentValue = animation.getKeys()[0].value;
                    var targetValue = animation.getKeys()[1].value;
                    var newValue = BABYLON.Scalar.Lerp(currentValue, targetValue, normalizedTime);
                    camera.radius = newValue;

                    if (normalizedTime === 1) {
                        scene.unregisterBeforeRender(arguments.callee);
                    }
                });

                // å¼€å§‹åŠ¨ç”»
                scene.beginAnimation(camera, 0, 60, false);
            });

            // æ¸²æŸ“å¾ªç¯
            engine.runRenderLoop(function () {
                scene.render();
            });

            // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´å¼•æ“çš„å¤§å°
            window.addEventListener("resize", function () {
                engine.resize();
            });
        });
    </script>
</body>
</html>
```

![image-20231207220028283](Babylon.js.assets/image-20231207220028283.png)

#### é«˜äº®èšç„¦å¹¶æ˜¾ç¤ºæ ‡ç­¾

è¦å°†æ˜¾ç¤ºæ ‡ç­¾çš„divç§»åŠ¨åˆ°é«˜äº®çš„Meshæ—è¾¹ï¼Œéœ€è¦å°†Meshçš„ä¸–ç•Œåæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡ã€‚Babylon.jsæä¾›äº†ä¸€ç§å°†3Dä¸–ç•Œåæ ‡è½¬æ¢ä¸º2Då±å¹•åæ ‡çš„æ–¹æ³•ã€‚

* ä½¿ç”¨äº†`BABYLON.Vector3.Project`æ–¹æ³•å°†Meshçš„ä¸–ç•Œåæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡ã€‚

* ä½¿ç”¨äº†`engine.getRenderWidth()`å’Œ`engine.getRenderHeight()`æ¥è·å–æ¸²æŸ“ç”»å¸ƒçš„å®½åº¦å’Œé«˜åº¦ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™`BABYLON.Vector3.Project`æ–¹æ³•ã€‚

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <title>Babylon.js Example</title>
    <meta charset="UTF-8">
    <style>
        body { margin: 0; }
        canvas { width: 100%; height: 100%; }
        .highlighted-div {
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <canvas id="renderCanvas"></canvas>
    <button id="highlightButton">Highlight Sphere and Focus</button>
    <div id="infoDiv" class="highlighted-div"></div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // åˆ›å»ºå¼•æ“
            var canvas = document.getElementById("renderCanvas");
            var engine = new BABYLON.Engine(canvas, true);

            // åˆ›å»ºåœºæ™¯
            var scene = new BABYLON.Scene(engine);

            // åˆ›å»ºç›¸æœº
            var camera = new BABYLON.ArcRotateCamera("Camera", Math.PI / 2, Math.PI / 4, 4, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            // åˆ›å»ºå…‰æº
            var light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);

            // åˆ›å»ºçƒä½“
            var sphere = BABYLON.MeshBuilder.CreateSphere("sphere", { diameter: 1 }, scene);
            sphere.position.y = 1;

            // åˆ›å»ºåœ†æŸ±ä½“
            var cylinder = BABYLON.MeshBuilder.CreateCylinder("cylinder", { height: 1, diameter: 1 }, scene);
            cylinder.position.y = 0.5;

            // åˆ›å»ºé«˜äº®æ•ˆæœ
            var highlightLayer = new BABYLON.HighlightLayer("highlightLayer", scene);

            // ç‚¹å‡»æŒ‰é’®æ—¶é«˜äº®çƒä½“å¹¶èšç„¦
            var highlightButton = document.getElementById("highlightButton");
            highlightButton.addEventListener("click", function () {
                highlightLayer.addMesh(sphere, BABYLON.Color3.Yellow());

                var targetPosition = sphere.position.clone();
                var targetRadius = 2;
                var animationDuration = 2000; // 2ç§’

                var animation = new BABYLON.Animation("cameraAnimation", "radius", 60, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);
                var keys = [
                    { frame: 0, value: camera.radius },
                    { frame: 60, value: targetRadius }
                ];
                animation.setKeys(keys);

                var startTime = performance.now();
                scene.registerBeforeRender(function () {
                    var currentTime = performance.now();
                    var deltaTime = currentTime - startTime;
                    var normalizedTime = Math.min(deltaTime / animationDuration, 1);

                    var currentValue = animation.getKeys()[0].value;
                    var targetValue = animation.getKeys()[1].value;
                    var newValue = BABYLON.Scalar.Lerp(currentValue, targetValue, normalizedTime);
                    camera.radius = newValue;

                    if (normalizedTime === 1) {
                        scene.unregisterBeforeRender(arguments.callee);
                    }
                });

                // å¼€å§‹åŠ¨ç”»
                scene.beginAnimation(camera, 0, 60, false);

                // è·å–Meshçš„å±å¹•åæ ‡
                var meshPosition = BABYLON.Vector3.Project(
                    sphere.position,
                    BABYLON.Matrix.Identity(),
                    scene.getTransformMatrix(),
                    camera.viewport.toGlobal(engine.getRenderWidth(), engine.getRenderHeight())
                );
                console.log(sphere.position, meshPosition);
                // ç§»åŠ¨divåˆ°å±å¹•åæ ‡å¤„
                var infoDiv = document.getElementById("infoDiv");
                infoDiv.innerHTML = "é€‰ä¸­çš„Meshåç§°ï¼š" + sphere.name;
                infoDiv.style.left = meshPosition.x + "px";
                infoDiv.style.top = meshPosition.y + "px";
                infoDiv.style.display = "block";
            });

            // æ¸²æŸ“å¾ªç¯
            engine.runRenderLoop(function () {
                scene.render();
            });

            // çª—å£å¤§å°æ”¹å˜æ—¶è°ƒæ•´å¼•æ“çš„å¤§å°
            window.addEventListener("resize", function () {
                engine.resize();
            });
        });
    </script>
</body>
</html>
```

![image-20231208220112856](Babylon.js.assets/image-20231208220112856.png)

## ç‰©ç†å¼•æ“å’Œç¢°æ’æ£€æµ‹

ç‰©ç†å¼•æ“æ˜¯ä¸€ä¸ªç”¨äºæ¨¡æ‹Ÿç‰©ä½“è¿åŠ¨å’Œç¢°æ’çš„å·¥å…·ã€‚åœ¨æ¸¸æˆå¼€å‘å’Œæ¨¡æ‹Ÿä»¿çœŸç­‰é¢†åŸŸä¸­ï¼Œç‰©ç†å¼•æ“è¢«å¹¿æ³›åº”ç”¨ã€‚Babylon.js æä¾›äº†å†…ç½®çš„ç‰©ç†å¼•æ“ï¼Œä½¿ä½ èƒ½å¤Ÿè½»æ¾åœ°æ¨¡æ‹Ÿç‰©ä½“çš„è¿åŠ¨å’Œå®ç°ç¢°æ’æ£€æµ‹ä¸å“åº”ã€‚

### ä½¿ç”¨ç‰©ç†å¼•æ“æ¨¡æ‹Ÿç‰©ä½“çš„è¿åŠ¨

è¦åœ¨ Babylon.js ä¸­ä½¿ç”¨ç‰©ç†å¼•æ“æ¨¡æ‹Ÿç‰©ä½“çš„è¿åŠ¨ï¼Œä½ éœ€è¦è¿›è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

1. åˆ›å»ºåœºæ™¯å’Œç‰©ç†å¼•æ“ï¼šä½¿ç”¨ `BABYLON.Engine` å’Œ `BABYLON.PhysicsEngine` ç±»åˆ›å»ºåœºæ™¯å’Œç‰©ç†å¼•æ“å®ä¾‹ã€‚ä¾‹å¦‚ï¼š

```javascript
var canvas = document.getElementById("idcanvas");
var engine = new BABYLON.Engine(canvas, true);
var scene = new BABYLON.Scene(engine);
var physicsEngine = new BABYLON.PhysicsEngine(scene);
```

2. åˆ›å»ºç‰©ä½“ï¼šä½¿ç”¨ `BABYLON.Mesh` ç±»åˆ›å»ºéœ€è¦æ¨¡æ‹Ÿè¿åŠ¨çš„ç‰©ä½“ã€‚ä¾‹å¦‚ï¼š

```javascript
var sphere = BABYLON.Mesh.CreateSphere("sphere", 16, 2, scene);
```

3. æ·»åŠ ç‰©ç†å±æ€§ï¼šä¸ºç‰©ä½“æ·»åŠ ç‰©ç†å±æ€§ï¼Œå¦‚è´¨é‡ã€æ‘©æ“¦åŠ›ç­‰ã€‚ä¾‹å¦‚ï¼š

```javascript
physicsEngine.addImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, friction: 0.5, restitution: 0.5 });
```

4. æ›´æ–°åœºæ™¯ï¼šåœ¨æ¯ä¸€å¸§æ›´æ–°åœºæ™¯å’Œç‰©ç†å¼•æ“ã€‚ä¾‹å¦‚ï¼š

```javascript
scene.registerBeforeRender(function () {
  physicsEngine.runOneStep();
});
```

5. æ¸²æŸ“åœºæ™¯ï¼šä½¿ç”¨ `engine.runRenderLoop()` æ–¹æ³•æ¸²æŸ“åœºæ™¯ã€‚ä¾‹å¦‚ï¼š

```javascript
engine.runRenderLoop(function () {
  scene.render();
});
```

é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œç‰©ä½“å°†æ ¹æ®ç‰©ç†å¼•æ“çš„æ¨¡æ‹Ÿè¿›è¡Œè¿åŠ¨ã€‚

### ç®€å•çš„ç¢°æ’æ£€æµ‹å’Œå“åº”

Babylon.js çš„ç‰©ç†å¼•æ“è¿˜æä¾›äº†ç¢°æ’æ£€æµ‹å’Œå“åº”çš„åŠŸèƒ½ã€‚ä½ å¯ä»¥ä½¿ç”¨ç¢°æ’æ£€æµ‹æ¥åˆ¤æ–­ç‰©ä½“æ˜¯å¦å‘ç”Ÿç¢°æ’ï¼Œå¹¶æ ¹æ®éœ€è¦æ‰§è¡Œç›¸åº”çš„å“åº”æ“ä½œã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å®ç°ç®€å•çš„ç¢°æ’æ£€æµ‹å’Œå“åº”ï¼š

> Babylon.js çš„ç‰©ç†å¼•æ“å¯ä»¥ä½¿ç”¨ 3 ä¸ªç‰©ç†æ’ä»¶-
>
> * Cannon.js
>
> * Oimo.js
> * Energy.js

#### Cannon.js

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Babylon.js v6 å’Œ Cannon.jsï¼Œåœ¨åœºæ™¯ä¸­åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„ç‰©ç†åœºæ™¯ã€‚åœºæ™¯åŒ…æ‹¬ä¸€ä¸ªåœ°é¢å’Œä¸€ä¸ªçƒä½“ï¼Œçƒä½“ä¼šå—åˆ°é‡åŠ›ä½œç”¨è€Œä¸‹è½åˆ°åœ°é¢ä¸Šã€‚

æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ `BABYLON.CannonJSPlugin` å°† Cannon.js ç‰©ç†å¼•æ“é›†æˆåˆ° Babylon.js ä¸­ã€‚ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰é‡åŠ›æ•ˆæœçš„ç‰©ç†åœºæ™¯ï¼Œå¹¶åº”ç”¨äº†ç‰©ç†å¼•æ“åˆ°åœ°é¢å’Œçƒä½“ä¸Šã€‚

![image-20231206142842267](Babylon.js.assets/image-20231206142842267.png)

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Babylon.js with Cannon.js Example</title>
    <style>
      #renderCanvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon/build/cannon.min.js"></script>
    <script>
      const canvas = document.getElementById("renderCanvas");
      const engine = new BABYLON.Engine(canvas, true);
      const scene = new BABYLON.Scene(engine);
      const gravityVector = new BABYLON.Vector3(0, -9.81, 0);
      const physicsPlugin = new BABYLON.CannonJSPlugin();
      scene.enablePhysics(gravityVector, physicsPlugin);
      const camera = new BABYLON.ArcRotateCamera("camera", 0, 0, 10, BABYLON.Vector3.Zero(), scene);
      camera.attachControl(canvas, true);
      const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0, 1, 0), scene);
      const ground = BABYLON.MeshBuilder.CreateGround("ground", { width: 10, height: 10 }, scene);
      ground.physicsImpostor = new BABYLON.PhysicsImpostor(ground, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0 }, scene);
      const sphere = BABYLON.MeshBuilder.CreateSphere("sphere", { diameter: 1 }, scene);
      sphere.position.y = 5;
      sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1 }, scene);
      engine.runRenderLoop(() => {
        scene.render();
      });
      window.addEventListener("resize", () => {
        engine.resize();
      });
    </script>
  </body>
</html>
```

#### Oimo.js

![image-20231119224243026](Babylon.js.assets/image-20231119224243026.png)

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!doctype html>
<html>
   <head>
      <meta charset = "utf-8">
      <title>BabylonJs-Ball/Ground Demo</title>
      <script type = "text/javascript" src="https://cdn.babylonjs.com/Oimo.js"></script>
      <script src = "https://cdn.babylonjs.com/babylon.js"></script>	
      <style>
         canvas {width: 100%; height: 100%;}
      </style>
   </head>
   <body>
      <canvas id = "renderCanvas"></canvas>
      <script type = "text/javascript">
         var canvas = document.getElementById("renderCanvas");
         var engine = new BABYLON.Engine(canvas, true);
         var v3 = BABYLON.Vector3;
         
         var createScene = function () {	
            // this creates a basic Babylon Scene object (non-mesh)
            var scene = new BABYLON.Scene(engine);
            var camera = new BABYLON.ArcRotateCamera("Camera", 0.86, 1.37, 250, BABYLON.Vector3.Zero(), scene);
            
            camera.attachControl(canvas);
            camera.maxZ = 5000;
            camera.lowerRadiusLimit = 120;
            camera.upperRadiusLimit = 430;
            camera.lowerBetaLimit =0.75;
            camera.upperBetaLimit =1.58 ;
            new BABYLON.HemisphericLight("hemi", new BABYLON.Vector3(0, 1, 0), scene);
            var randomNumber = function (min, max) {
               if (min == max) {
                  return (min);
               }
               var random = Math.random();
               return ((random * (max-min)) + min);
            };
            var mat = new BABYLON.StandardMaterial("ground", scene);
            var t = new BABYLON.Texture("./marble.jpg", scene);
            t.uScale = t.vScale = 10;
            mat.diffuseTexture = t;
            mat.specularColor = BABYLON.Color3.Black();
            
            var g = BABYLON.Mesh.CreateBox("ground", 200, scene);
            
            g.position.y =-20;
            g.position.x = 0
            g.scaling.y = 0.01;
            g.material = mat;	
            
            scene.enablePhysics(new BABYLON.Vector3(0,-10, 0), new BABYLON.OimoJSPlugin());
            
            g.physicsImpostor = new BABYLON.PhysicsImpostor(g, BABYLON.PhysicsImpostor.BoxImpostor, { 
               mass: 0, 
               restitution: 0.9 
            }, scene);
            
            var getPosition = function(y) {
               return new v3(randomNumber(-100, 100), y, randomNumber(-100, 100));
            };
            
            var allspheres = [];
            var y = 50;
            var max = 50;
            
            for (var index = 0; index < max; index++) {
               var redSphere = BABYLON.Mesh.CreateSphere("s" + index, 32, 8, scene);
               redSphere.position = getPosition(y);
               redSphere.physicsImpostor = new BABYLON.PhysicsImpostor(redSphere, BABYLON.PhysicsImpostor.SphereImpostor,{
                  mass: 1, restitution:0.9
               }, scene);
               
               redSphere.physicsImpostor.applyImpulse(new BABYLON.Vector3(1, 2,-1), new BABYLON.Vector3(1, 2, 0));
               
               var redMat = new BABYLON.StandardMaterial("ground", scene);
               redMat.diffuseColor = new BABYLON.Color3(0.4, 0.4, 0.4);
               redMat.specularColor = new BABYLON.Color3(0.4, 0.4, 0.4);
               redMat.emissiveColor = BABYLON.Color3.Red();
               redSphere.material = redMat;
               
               // push all spheres in the allspheres variable
               allspheres.push(redSphere);			
               y += 10; // increment height
            }
            scene.registerBeforeRender(function() {
               allspheres.forEach(function(obj) { 
                  // if the sphers falls down its updated again over here
                  // if object falls
                  if (obj.position.y <-100) {
                     obj.position = getPosition(200);				
                  }
               });
            })
            return scene;
         };
         var scene = createScene();
         engine.runRenderLoop(function() {
            scene.render();
         });
      </script>
   </body>
</html>
```

## å¯¼å…¥å’Œå¯¼å‡º

### å¯¼å…¥å¤–éƒ¨æ¨¡å‹å’Œåœºæ™¯

è¦å¯¼å…¥å¤–éƒ¨æ¨¡å‹å’Œåœºæ™¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ Babylon.js æä¾›çš„åŠ è½½å™¨å’Œå¯¼å…¥åŠŸèƒ½ã€‚Babylon.js æ”¯æŒå¤šç§æ ¼å¼çš„æ¨¡å‹å’Œåœºæ™¯å¯¼å…¥ï¼ŒåŒ…æ‹¬ glTFã€OBJã€FBX ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å¯¼å…¥å¤–éƒ¨æ¨¡å‹å’Œåœºæ™¯ï¼š

> https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.jsè¿™ä¸ªé“¾æ¥ä¼šåŠ è½½åŒ…å«äº† glTF å¯¼å…¥åŠŸèƒ½çš„ Babylon.js åŠ è½½å™¨æ¨¡å—ã€‚å®ƒåŒ…å«äº† BABYLON.GLTFFileLoader æ’ä»¶ã€‚
>
> ç¡®ä¿åœ¨å¼•å…¥ Babylon.js çš„ä¸»è¦åº“æ–‡ä»¶ä¹‹åï¼Œå¼•å…¥è¿™ä¸ªåŠ è½½å™¨æ¨¡å—ã€‚
>
> ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ `BABYLON.SceneLoader.ImportMesh()` æ–¹æ³•æ¥å¯¼å…¥ .glb æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨æ³¨å†Œæ’ä»¶ï¼š

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¼å…¥å¤–éƒ¨æ¨¡å‹</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
        /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
        touch-action: none;
      }
    </style>
  </head>
  <body>
    <canvas id="idcanvas"></canvas>
    <script type="text/javascript">
      // åˆ›å»ºåœºæ™¯å’Œç›¸æœº
      var canvas = document.getElementById('idcanvas')
      var engine = new BABYLON.Engine(canvas, true)
      var scene = new BABYLON.Scene(engine)
      var camera = new BABYLON.FreeCamera('camera', new BABYLON.Vector3(0, 0, -10), scene)
      camera.setTarget(BABYLON.Vector3.Zero())
      camera.attachControl(canvas, true)
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
      // å¯¼å…¥ glTF æ’ä»¶
      BABYLON.SceneLoader.RegisterPlugin(new BABYLON.GLTFFileLoader())
      // å¯¼å…¥å¤–éƒ¨æ¨¡å‹æˆ–åœºæ™¯
      BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Duck.glb', scene, function (meshes) {
        // åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ“ä½œ
        // meshes æ˜¯åŒ…å«å¯¼å…¥çš„æ¨¡å‹çš„æ•°ç»„

        // ä¾‹å¦‚ï¼Œè°ƒæ•´æ¨¡å‹çš„ä½ç½®ã€ç¼©æ”¾æˆ–æ—‹è½¬ç­‰
        meshes[0].position = new BABYLON.Vector3(0, 0, 0)
        meshes[0].scaling = new BABYLON.Vector3(1, 1, 1)
      })

      // æ¸²æŸ“åœºæ™¯
      engine.runRenderLoop(function () {
        scene.render()
      })

      // å¤„ç†çª—å£å¤§å°å˜åŒ–
      window.addEventListener('resize', function () {
        engine.resize()
      })
    </script>
  </body>
</html>
```

![image-20231119225825878](Babylon.js.assets/image-20231119225825878.png)

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `BABYLON.SceneLoader.ImportMesh()` æ–¹æ³•æ¥å¯¼å…¥å¤–éƒ¨æ¨¡å‹æˆ–åœºæ™¯ã€‚è¯¥æ–¹æ³•æ¥å—å¤šä¸ªå‚æ•°ï¼ŒåŒ…æ‹¬æ¨¡å‹çš„æ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶åä»¥åŠåœºæ™¯å¯¹è±¡ç­‰ã€‚åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­ï¼Œä½ å¯ä»¥å¯¹å¯¼å…¥çš„æ¨¡å‹è¿›è¡Œæ“ä½œï¼Œä¾‹å¦‚è°ƒæ•´ä½ç½®ã€ç¼©æ”¾æˆ–æ—‹è½¬ç­‰ã€‚

è¯·ç¡®ä¿æ›¿æ¢ä»£ç ä¸­çš„æ–‡ä»¶è·¯å¾„å’Œæ–‡ä»¶åï¼Œä»¥é€‚åº”ä½ è‡ªå·±çš„æ¨¡å‹å’Œåœºæ™¯æ–‡ä»¶ã€‚

åœ¨æ¸²æŸ“å¾ªç¯ä¸­è°ƒç”¨ `scene.render()` æ–¹æ³•æ¥æ¸²æŸ“åœºæ™¯ã€‚

è¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ç¤ºä¾‹ï¼Œç”¨äºå¯¼å…¥å¤–éƒ¨æ¨¡å‹å’Œåœºæ™¯ã€‚å…·ä½“çš„å¯¼å…¥è¿‡ç¨‹å¯èƒ½å› æ‰€ä½¿ç”¨çš„æ–‡ä»¶æ ¼å¼å’Œåœºæ™¯è¦æ±‚è€Œæœ‰æ‰€ä¸åŒã€‚ä½ å¯ä»¥æŸ¥é˜… Babylon.js çš„å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šå…³äºå¯¼å…¥æ¨¡å‹å’Œåœºæ™¯çš„è¯¦ç»†ä¿¡æ¯å’Œæ”¯æŒçš„æ–‡ä»¶æ ¼å¼ã€‚

å¦‚æœæˆ‘ä»¬æƒ³æ˜¾ç¤ºå¤šä¸ªå¯¼å…¥çš„å¤–éƒ¨æ¨¡å‹ï¼Œæˆ‘ä»¬åªè°ƒç”¨ä¸€æ¬¡`ImportMesh`æ–¹æ³•æ¥å¯¼å…¥é¸­å­æ¨¡å‹ï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨`clone`æ–¹æ³•æ¥å¤åˆ¶æ¨¡å‹å¹¶åœ¨åœºæ™¯ä¸­æ˜¾ç¤ºå¤šä¸ªé¸­å­ã€‚

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å…¥å¤–éƒ¨æ¨¡å‹</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #idcanvas {
            width: 100%;
            height: 100%;
            /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="idcanvas"></canvas>
    <script type="text/javascript">
        // åˆ›å»ºåœºæ™¯å’Œç›¸æœº
        var canvas = document.getElementById('idcanvas')
        var engine = new BABYLON.Engine(canvas, true)
        var scene = new BABYLON.Scene(engine)
        var camera = new BABYLON.FreeCamera('camera', new BABYLON.Vector3(0, 0, -10), scene)
        camera.setTarget(BABYLON.Vector3.Zero())
        camera.attachControl(canvas, true)
        var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
        // å¯¼å…¥ glTF æ’ä»¶
        BABYLON.SceneLoader.RegisterPlugin(new BABYLON.GLTFFileLoader())

        // å¯¼å…¥é¸­å­æ¨¡å‹
        BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Duck.glb', scene, function (meshes) {
            // åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ“ä½œ
            // meshes æ˜¯åŒ…å«å¯¼å…¥çš„æ¨¡å‹çš„æ•°ç»„

            // å¾ªç¯å¤åˆ¶å¹¶æ˜¾ç¤ºå¤šä¸ªé¸­å­
            var duckCount = 5;
            for (var i = 0; i < duckCount; i++) {
                var clonedDuck = meshes[0].clone('clonedDuck' + i);
                clonedDuck.position = new BABYLON.Vector3(i + 2, 0, 0);
                clonedDuck.scaling = new BABYLON.Vector3(1, 1, 1);
            }
        });

        // æ¸²æŸ“åœºæ™¯
        engine.runRenderLoop(function () {
            scene.render()
        })

        // å¤„ç†çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', function () {
            engine.resize()
        })
    </script>
</body>
</html>

```

![image-20231209080100270](Babylon.js.assets/image-20231209080100270.png)

### æ’­æ”¾å¤–éƒ¨æ¨¡å‹åŠ¨ç”»

è¦é€šè¿‡ Babylon.js è·å– glTF æ–‡ä»¶ä¸­å†…ç½®çš„åŠ¨ç”»åˆ—è¡¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ `BABYLON.GLTFFileLoader` åŠ è½½å™¨å’Œ `BABYLON.GLTFLoader` ç±»çš„æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•è¯»å– glTF æ–‡ä»¶ä¸­çš„åŠ¨ç”»åˆ—è¡¨ï¼š

> ä¸ºäº†åŠ å¿«æ¨¡å‹åŠ è½½ï¼Œä¸‹é¢ä¾‹å­ä¸­**Bee-compressed.glb**ä½¿ç”¨äº†é«˜å‹ç¼©æ¯”çš„æ¨¡å‹ï¼Œæ‰€ä»¥æ²¡æœ‰**çº¹ç†**ã€‚

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¼å…¥å¤–éƒ¨æ¨¡å‹</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
        /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
        touch-action: none;
      }
    </style>
  </head>
  <body>
    <canvas id="idcanvas"></canvas>
    <script type="text/javascript">
      // åˆ›å»ºåœºæ™¯å’Œç›¸æœº
      var canvas = document.getElementById('idcanvas')
      var engine = new BABYLON.Engine(canvas, true)
      var scene = new BABYLON.Scene(engine)
      var camera = new BABYLON.FreeCamera('camera', new BABYLON.Vector3(0, 0, -10), scene)
      camera.setTarget(BABYLON.Vector3.Zero())
      camera.attachControl(canvas, true)
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
      // å¯¼å…¥ glTF æ’ä»¶
      BABYLON.SceneLoader.RegisterPlugin(new BABYLON.GLTFFileLoader())
      // å¯¼å…¥å¤–éƒ¨æ¨¡å‹æˆ–åœºæ™¯
      BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Bee-compressed.glb', scene, function (meshes) {
        // åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ“ä½œ
        // meshes æ˜¯åŒ…å«å¯¼å…¥çš„æ¨¡å‹çš„æ•°ç»„
        meshes[0].scaling = new BABYLON.Vector3(0.1, 0.1, 0.1)
        // è·å–åŠ¨ç”»ç»„
        let animationGroups = scene.animationGroups
        // æ‰“å°åŠ¨ç”»ç»„æ•°é‡
        console.log('Animation Group Count: ', animationGroups.length)
        // éå†åŠ¨ç”»ç»„å¹¶æ‰“å°åŠ¨ç”»åç§°ï¼Œæ’­æ”¾åŠ¨ç”»
        animationGroups.forEach(function (animationGroup) {
          console.log('Animation Group Name: ', animationGroup.name)
          animationGroup.play()
        })
      })

      // æ¸²æŸ“åœºæ™¯
      engine.runRenderLoop(function () {
        scene.render()
      })

      // å¤„ç†çª—å£å¤§å°å˜åŒ–
      window.addEventListener('resize', function () {
        engine.resize()
      })
    </script>
  </body>
</html>
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `BABYLON.SceneLoader.ImportMesh()` æ–¹æ³•åŠ è½½ glTF æ–‡ä»¶ï¼Œå¹¶åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ“ä½œã€‚æˆ‘ä»¬ä½¿ç”¨ `let animationGroups = scene.animationGroups` æ–¹æ³•è·å–åŠ¨ç”»åˆ—è¡¨ã€‚

ç„¶åï¼Œæˆ‘ä»¬éå†åŠ¨ç”»åˆ—è¡¨å¹¶æ‰“å°å‡ºæ¯ä¸ªåŠ¨ç”»çš„åç§°å¹¶æ’­æ”¾ã€‚

![image-20231120174646290](Babylon.js.assets/image-20231120174646290.png)

### é«˜äº®æ¨¡å‹ä¸­çš„é€‰å®šmesh

å¦‚æœä½ æƒ³è¦é«˜äº®æ¨¡å‹ä¸­çš„é€‰å®šmeshï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæ“ä½œï¼š

1. åœ¨ Babylon.js ä¸­å¯¼å…¥æ¨¡å‹æ–‡ä»¶ï¼Œå¹¶å°†å…¶åŠ è½½åˆ°åœºæ™¯ä¸­ã€‚å¯ä»¥ä½¿ç”¨ `BABYLON.SceneLoader.ImportMesh` æ–¹æ³•æ¥åŠ è½½æ¨¡å‹ã€‚
2. åœ¨åˆé€‚çš„ä½ç½®åˆ›å»º `HighlightLayer` å¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°åœºæ™¯ä¸­ã€‚
3. æ ¹æ®éœ€è¦ï¼Œåˆ›å»ºä¸€ä¸ª `highlightMesh` å˜é‡æ¥å­˜å‚¨å½“å‰è¢«é€‰ä¸­çš„ meshã€‚
4. åœ¨é¼ æ ‡ç‚¹å‡»æˆ–å…¶ä»–äº‹ä»¶ä¸­ï¼Œè·å–é¼ æ ‡ç‚¹å‡»çš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨ `BABYLON.Scene.pick` æ–¹æ³•æ¥è·å–è¢«ç‚¹å‡»çš„ meshã€‚
5. å¦‚æœå­˜åœ¨å…ˆå‰é€‰ä¸­çš„ meshï¼Œä» `highlightMesh` ä¸­ç§»é™¤é«˜äº®æ•ˆæœã€‚
6. å°†æ–°é€‰ä¸­çš„ mesh åŠ å…¥ `highlightMesh` ä¸­ï¼Œå¹¶ä½¿ç”¨ `highlight.addMesh` æ–¹æ³•æ¥åº”ç”¨é«˜äº®æ•ˆæœã€‚

> Babylon.jsä¸­çš„`BABYLON.Scene.pick`æ–¹æ³•å¯ä»¥ç”¨äºå±å¹•åæ ‡ä¸ä¸–ç•Œåæ ‡ä¹‹é—´çš„è½¬æ¢ã€‚`pick`æ–¹æ³•å¯ä»¥é€šè¿‡æä¾›å±å¹•åæ ‡ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰æ¥è·å–åœºæ™¯ä¸­ä¸è¯¥å±å¹•ä½ç½®æœ€è¿‘çš„Meshã€‚
>
> ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨`pick`æ–¹æ³•å°†å±å¹•åæ ‡è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ï¼š
>
> ```javascript
> // è·å–å±å¹•åæ ‡
> var screenX = 100; // å±å¹•Xåæ ‡
> var screenY = 200; // å±å¹•Yåæ ‡
> 
> // è°ƒç”¨pickæ–¹æ³•å°†å±å¹•åæ ‡è½¬æ¢ä¸ºä¸–ç•Œåæ ‡
> var pickResult = scene.pick(screenX, screenY);
> 
> // è·å–pickç»“æœä¸­çš„ä¸–ç•Œåæ ‡
> var worldPosition = pickResult.pickedPoint;
> 
> console.log("å±å¹•åæ ‡ (" + screenX + ", " + screenY + ") è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ä¸º:", worldPosition);
> ```
>
> åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†å±å¹•åæ ‡`screenX`å’Œ`screenY`ï¼Œç„¶åä½¿ç”¨`pick`æ–¹æ³•å°†å…¶è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ã€‚`pick`æ–¹æ³•è¿”å›ä¸€ä¸ª`pickResult`å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†ä¸å±å¹•ä½ç½®æœ€è¿‘çš„Meshçš„ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚ä¸–ç•Œåæ ‡ã€æ³•çº¿ç­‰ã€‚
>
> è¯·æ³¨æ„ï¼Œ`pick`æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª`pickResult`å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»ä¸­æå–å‡ºä¸–ç•Œåæ ‡ç­‰ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¸å±å¹•ä½ç½®æœ€è¿‘çš„Meshï¼Œ`pickResult.pickedPoint`å°†ä¸º`null`ã€‚

ğŸ¤–ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š

```html
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¼å…¥å¤–éƒ¨æ¨¡å‹</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="idcanvas"></canvas>
    <script type="text/javascript">
      // è·å–ç”»å¸ƒå…ƒç´ 
      const canvas = document.getElementById('idcanvas')

      // åˆ›å»ºåœºæ™¯
      const createScene = () => {
        const scene = new BABYLON.Scene(engine)

        // åˆ›å»ºç›¸æœº
        const camera = new BABYLON.ArcRotateCamera('camera', 0, 0, 10, BABYLON.Vector3.Zero(), scene)
        camera.setPosition(new BABYLON.Vector3(0, 0, -10))
        camera.attachControl(canvas, true)

        // åˆ›å»ºç¯å…‰
        const light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)

        // å¯¼å…¥æ¨¡å‹
        BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Feed check vavle assembly.glb', scene, meshes => {
          const model = meshes[0]

          // åˆ›å»ºé«˜äº®æ•ˆæœ
          const highlight = new BABYLON.HighlightLayer('highlight', scene)

          // ç”¨äºå­˜å‚¨å½“å‰é€‰ä¸­çš„ mesh
          let highlightMesh = null

          // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
          canvas.addEventListener('pointerdown', event => {
            // è·å–é¼ æ ‡ç‚¹å‡»ä½ç½®
            const pickResult = scene.pick(scene.pointerX, scene.pointerY)

            // å¦‚æœæœ‰å…ˆå‰é€‰ä¸­çš„ meshï¼Œåˆ™ç§»é™¤é«˜äº®æ•ˆæœ
            if (highlightMesh) {
              highlight.removeMesh(highlightMesh)
            }

            // å°†æ–°é€‰ä¸­çš„ mesh åŠ å…¥ highlightMesh
            highlightMesh = pickResult.pickedMesh
            highlight.addMesh(highlightMesh, BABYLON.Color3.Green())
          })
        })

        return scene
      }

      // åˆ›å»ºå¼•æ“
      const engine = new BABYLON.Engine(canvas, true)

      // åˆ›å»ºåœºæ™¯
      const scene = createScene()

      // æ¸²æŸ“åœºæ™¯
      engine.runRenderLoop(() => {
        scene.render()
      })

      // è°ƒæ•´ç”»å¸ƒå¤§å°
      window.addEventListener('resize', () => {
        engine.resize()
      })
    </script>
  </body>
</html>
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‡è®¾æ¨¡å‹æ–‡ä»¶æ˜¯ `Feed check vavle assembly.SLDASM.zip.glb`ï¼Œä½ éœ€è¦å°†å…¶æ›¿æ¢ä¸ºä½ è‡ªå·±çš„æ¨¡å‹æ–‡ä»¶è·¯å¾„ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨é¼ æ ‡ç‚¹å‡»äº‹ä»¶ä¸­è·å–é¼ æ ‡ç‚¹å‡»çš„ä½ç½®ï¼Œå¹¶ä½¿ç”¨ `pickResult.pickedMesh` è·å–è¢«ç‚¹å‡»çš„ meshã€‚å¦‚æœå…ˆå‰å·²ç»é€‰ä¸­äº†ä¸€ä¸ª meshï¼Œåˆ™å°†å…¶ä» `highlightMesh` ä¸­ç§»é™¤ï¼Œå¹¶å°†æ–°é€‰ä¸­çš„ mesh åŠ å…¥ `highlightMesh` ä¸­ï¼Œç„¶åä½¿ç”¨ `highlight.addMesh` æ–¹æ³•æ¥åº”ç”¨é«˜äº®æ•ˆæœã€‚

![image-20231122222146803](Babylon.js.assets/image-20231122222146803.png)

### å¯¼å‡º Babylon.js åœºæ™¯å’Œå¯¹è±¡

#### å¯¼å‡ºä¸ºJSON 

è¦å¯¼å‡º Babylon.js åœºæ™¯å’Œå¯¹è±¡ï¼Œä½ å¯ä»¥ä½¿ç”¨ Babylon.js æä¾›çš„åºåˆ—åŒ–åŠŸèƒ½ã€‚Babylon.js æä¾›äº†å°†åœºæ™¯å’Œå¯¹è±¡è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œä»è€Œå¯ä»¥å°†å®ƒä»¬ä¿å­˜åˆ°æ–‡ä»¶æˆ–ä¼ è¾“ç»™å…¶ä»–åº”ç”¨ç¨‹åºã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºå¦‚ä½•å¯¼å‡º Babylon.js åœºæ™¯å’Œå¯¹è±¡ï¼š

```javascript
// åˆ›å»ºåœºæ™¯å’Œç‰©ä½“
var canvas = document.getElementById("idcanvas");
var engine = new BABYLON.Engine(canvas, true);
var scene = new BABYLON.Scene(engine);
var box = BABYLON.MeshBuilder.CreateBox("box", {}, scene);

// å°†åœºæ™¯å’Œå¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²
var serializedScene = JSON.stringify(scene.serialize());
var serializedObject = JSON.stringify(box.serialize());

// è¾“å‡º JSON å­—ç¬¦ä¸²
console.log("Serialized Scene: ", serializedScene);
console.log("Serialized Object: ", serializedObject);
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåœºæ™¯å’Œä¸€ä¸ªç«‹æ–¹ä½“å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ `scene.serialize()` æ–¹æ³•å°†åœºæ™¯åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œå¹¶ä½¿ç”¨ `box.serialize()` æ–¹æ³•å°†ç«‹æ–¹ä½“å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚

æœ€åï¼Œæˆ‘ä»¬å°†åºåˆ—åŒ–åçš„åœºæ™¯å’Œå¯¹è±¡è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œä½ å¯ä»¥é€‰æ‹©å°†å…¶ä¿å­˜åˆ°æ–‡ä»¶æˆ–ä¼ è¾“ç»™å…¶ä»–åº”ç”¨ç¨‹åºã€‚

é€šè¿‡ä½¿ç”¨ Babylon.js çš„åºåˆ—åŒ–åŠŸèƒ½ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°å¯¼å‡ºåœºæ™¯å’Œå¯¹è±¡ï¼Œå¹¶ä¸å…¶ä»–åº”ç”¨ç¨‹åºè¿›è¡Œäº¤äº’ã€ä¿å­˜æˆ–å…±äº«ã€‚è¯·æ³¨æ„ï¼Œåªæœ‰åºåˆ—åŒ–çš„æ•°æ®ä¼šè¢«å¯¼å‡ºï¼Œä¸åœºæ™¯å’Œå¯¹è±¡ç›¸å…³çš„æ–¹æ³•å’Œè¡Œä¸ºä¸ä¼šè¢«åŒ…å«åœ¨å¯¼å‡ºçš„æ•°æ®ä¸­ã€‚

#### å¯¼å‡ºä¸ºå…¶å®ƒæ ¼å¼

Babylon.js ä¸ç›´æ¥æä¾›å°†åœºæ™¯å’Œå¯¹è±¡å¯¼å‡ºä¸º STLï¼ˆStandard Tessellation Languageï¼‰æ ¼å¼çš„åŠŸèƒ½ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æˆ–å·¥å…·æ¥å®ç°å°† Babylon.js åœºæ™¯å’Œå¯¹è±¡å¯¼å‡ºä¸º STL æ–‡ä»¶ã€‚

ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ `babylonjs-serializers` åº“ï¼Œå®ƒæ˜¯ Babylon.js å®˜æ–¹æä¾›çš„ä¸€ä¸ªé™„åŠ æ¨¡å—ã€‚è¿™ä¸ªåº“æä¾›äº†å°† Babylon.js åœºæ™¯å’Œå¯¹è±¡å¯¼å‡ºä¸ºå¤šç§æ ¼å¼çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ STLã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç ç¤ºä¾‹æ¥å¯¼å‡º:

```javascript
// å¯¼å…¥æ‰€éœ€çš„æ¨¡å—
import { STLExport } from 'babylonjs-serializers';

// åˆ›å»º STLExport å®ä¾‹
var exporter = new STLExport();

// å¯¼å‡ºå¯¹è±¡ä¸º STL æ–‡ä»¶
exporter.exportMesh(scene.getMeshByName("meshName"), "path/to/output.stl");
```

è¯·æ³¨æ„ï¼Œä½ éœ€è¦åœ¨é¡¹ç›®ä¸­å®‰è£… `babylonjs-serializers` åº“ï¼Œç„¶åä½¿ç”¨é€‚åˆä½ çš„æ„å»ºå·¥å…·ï¼ˆå¦‚Webpackï¼‰è¿›è¡Œå¯¼å…¥ã€‚

### é€‰å®šå¯¼å…¥çš„æ¨¡å‹å¹¶ç§»åŠ¨

è¿™æ˜¯ä¸€ä¸ªå¯¼å…¥çš„æ¨¡å‹å’Œé¼ æ ‡äº¤äº’çš„ç»¼åˆæ€§ä¾‹å­

* åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†é¼ æ ‡äº‹ä»¶ç›‘å¬å™¨ï¼ŒåŒ…æ‹¬ `pointerdown`ã€`pointermove` å’Œ `pointerup`ã€‚å½“é¼ æ ‡æŒ‰ä¸‹æ—¶ï¼Œæˆ‘ä»¬è®°å½•ä¸‹åˆå§‹çš„é¼ æ ‡ä½ç½®å’Œæ¨¡å‹çš„ä½ç½®ã€‚åœ¨é¼ æ ‡ç§»åŠ¨æœŸé—´ï¼Œæˆ‘ä»¬è®¡ç®—é¼ æ ‡çš„åç§»é‡ï¼Œå¹¶æ ¹æ®åç§»é‡è°ƒæ•´æ¨¡å‹çš„ä½ç½®ã€‚æœ€åï¼Œå½“é¼ æ ‡é‡Šæ”¾æ—¶ï¼Œåœæ­¢æ‹–æ‹½æ“ä½œã€‚
* åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨ `pointerdown` äº‹ä»¶ä¸­ä½¿ç”¨ `detachControl` æ–¹æ³•æš‚æ—¶è§£é™¤äº†ç›¸æœºçš„æ§åˆ¶ç»‘å®šï¼Œç„¶ååœ¨æ‹–æ‹½äº‹ä»¶å®Œæˆåä½¿ç”¨ `attachControl` æ–¹æ³•é‡æ–°ç»‘å®šäº†ç›¸æœºæ§åˆ¶ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åœ¨æ‹–æ‹½äº‹ä»¶æœŸé—´æš‚æ—¶è§£é™¤ç›¸æœºçš„æ§åˆ¶ç»‘å®šï¼Œä»¥å…ä¸æ‹–æ‹½äº‹ä»¶å†²çªã€‚å½“æ‹–æ‹½äº‹ä»¶å®Œæˆåï¼Œå†é‡æ–°ç»‘å®šç›¸æœºæ§åˆ¶ï¼Œä»¥ç»§ç»­ä½¿ç”¨ç›¸æœºæ§åˆ¶åŠŸèƒ½ã€‚

![image-20231206125642078](Babylon.js.assets/image-20231206125642078.png)

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Move Model with Mouse Drag</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
        /* ç¦ç”¨å…ƒç´ ä¸Šçš„æ‰€æœ‰æ‰‹åŠ¿ */
        touch-action: none;
      }
    </style>
  </head>
  <body>
    <canvas id="idcanvas"></canvas>
    <script type="text/javascript">
      // åˆ›å»ºåœºæ™¯å’Œç›¸æœº
      var canvas = document.getElementById('idcanvas')
      var engine = new BABYLON.Engine(canvas, true)
      var scene = new BABYLON.Scene(engine)
      var camera = new BABYLON.FreeCamera('camera', new BABYLON.Vector3(0, 0, -10), scene)
      camera.setTarget(BABYLON.Vector3.Zero())
      camera.attachControl(canvas, true)
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)
      // å¯¼å…¥ glTF æ’ä»¶
      BABYLON.SceneLoader.RegisterPlugin(new BABYLON.GLTFFileLoader())

      // å¯¼å…¥å¤–éƒ¨æ¨¡å‹æˆ–åœºæ™¯
      BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'car.gltf', scene, function (meshes) {
        // åœ¨åŠ è½½å®Œæˆåçš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œæ“ä½œ
        // meshes æ˜¯åŒ…å«å¯¼å…¥çš„æ¨¡å‹çš„æ•°ç»„

        // ä¾‹å¦‚ï¼Œè°ƒæ•´æ¨¡å‹çš„ä½ç½®ã€ç¼©æ”¾æˆ–æ—‹è½¬ç­‰
        meshes[0].position = new BABYLON.Vector3(0, 0, 0)
        meshes[0].scaling = new BABYLON.Vector3(1, 1, 1)

        // é¼ æ ‡æ‹–æ‹½äº‹ä»¶
        var dragMesh = meshes[0]
        var isDragging = false
        var startDragPos = new BABYLON.Vector3()
        var startMeshPos = new BABYLON.Vector3()

        canvas.addEventListener('pointerdown', function (event) {
          // æš‚æ—¶è§£é™¤ç›¸æœºæ§åˆ¶ç»‘å®š
          camera.detachControl(canvas)
          isDragging = true
          startDragPos.x = event.clientX
          startDragPos.y = event.clientY
          startMeshPos.copyFrom(dragMesh.position)
          camera.attachControl(canvas, true)
        })

        canvas.addEventListener('pointermove', function (event) {
          if (isDragging) {
            var deltaX = event.clientX - startDragPos.x
            var deltaY = event.clientY - startDragPos.y
            dragMesh.position.x = startMeshPos.x + deltaX / 100
            dragMesh.position.y = startMeshPos.y - deltaY / 100
          }
        })

        canvas.addEventListener('pointerup', function () {
          isDragging = false
        })
      })

      // æ¸²æŸ“åœºæ™¯
      engine.runRenderLoop(function () {
        scene.render()
      })

      // å¤„ç†çª—å£å¤§å°å˜åŒ–
      window.addEventListener('resize', function () {
        engine.resize()
      })
    </script>
  </body>
</html>

```

## éå†Mesh

åœ¨å¦‚ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª `createMeshDirectoryTree` å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ª Mesh ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªç›®å½•æ ‘å¯¹è±¡ã€‚ç›®å½•æ ‘å¯¹è±¡å…·æœ‰ `name` å±æ€§è¡¨ç¤º Mesh çš„åç§°ï¼Œä»¥åŠ `children` å±æ€§è¡¨ç¤ºå­çº§ Mesh çš„ç›®å½•æ ‘ã€‚

é€šè¿‡é€’å½’æ–¹å¼ï¼Œåœ¨å‡½æ•°ä¸­éå† Mesh çš„å­çº§ï¼Œå¹¶ä¸ºæ¯ä¸ªå­çº§åˆ›å»ºå¯¹åº”çš„ç›®å½•æ ‘å¯¹è±¡ã€‚æœ€åï¼Œè¿”å›æ ¹ Mesh çš„ç›®å½•æ ‘å¯¹è±¡ã€‚

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¼å…¥å¤–éƒ¨æ¨¡å‹</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #idcanvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <canvas id="idcanvas"></canvas>
    <script type="text/javascript">
      // è·å–ç”»å¸ƒå…ƒç´ 
      const canvas = document.getElementById('idcanvas')

      // åˆ›å»ºåœºæ™¯
      const createScene = () => {
        const scene = new BABYLON.Scene(engine)

        // åˆ›å»ºç›¸æœº
        const camera = new BABYLON.ArcRotateCamera('camera', 0, 0, 10, BABYLON.Vector3.Zero(), scene)
        camera.setPosition(new BABYLON.Vector3(0, 0, -10))
        camera.attachControl(canvas, true)

        // åˆ›å»ºç¯å…‰
        const light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)

        // å¯¼å…¥æ¨¡å‹
        BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Feed check vavle assembly.glb', scene, meshes => {
          const model = meshes[0]

          const meshDirectoryTree = createMeshDirectoryTree(model)
          console.log(meshDirectoryTree)

          // åˆ›å»ºé«˜äº®æ•ˆæœ
          const highlight = new BABYLON.HighlightLayer('highlight', scene)

          // ç”¨äºå­˜å‚¨å½“å‰é€‰ä¸­çš„ mesh
          let highlightMesh = null

          // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
          canvas.addEventListener('pointerdown', event => {
            // è·å–é¼ æ ‡ç‚¹å‡»ä½ç½®
            const pickResult = scene.pick(scene.pointerX, scene.pointerY)

            // å¦‚æœæœ‰å…ˆå‰é€‰ä¸­çš„ meshï¼Œåˆ™ç§»é™¤é«˜äº®æ•ˆæœ
            if (highlightMesh) {
              highlight.removeMesh(highlightMesh)
            }

            // å°†æ–°é€‰ä¸­çš„ mesh åŠ å…¥ highlightMesh
            highlightMesh = pickResult.pickedMesh
            highlight.addMesh(highlightMesh, BABYLON.Color3.Green())
          })
        })

        return scene
      }

      // åˆ›å»ºå¼•æ“
      const engine = new BABYLON.Engine(canvas, true)

      // åˆ›å»ºåœºæ™¯
      const scene = createScene()

      // æ¸²æŸ“åœºæ™¯
      engine.runRenderLoop(() => {
        scene.render()
      })

      // è°ƒæ•´ç”»å¸ƒå¤§å°
      window.addEventListener('resize', () => {
        engine.resize()
      })

      function createMeshDirectoryTree(mesh) {
        const directoryTree = {
          name: mesh.name,
          children: []
        }

        if (mesh.getChildMeshes) {
          const childMeshes = mesh.getChildMeshes()
          for (const childMesh of childMeshes) {
            const childDirectoryTree = createMeshDirectoryTree(childMesh)
            directoryTree.children.push(childDirectoryTree)
          }
        }

        return directoryTree
      }
    </script>
  </body>
</html>
```

> åœ¨ Babylon.js ä¸­ï¼Œ`Geometry` å¯¹è±¡æ˜¯è¢« `Mesh` å¯¹è±¡éšå¼åˆ›å»ºå’Œä½¿ç”¨çš„ã€‚Babylon.js çš„ `Mesh` å¯¹è±¡æœ¬èº«å°±åŒ…å«äº†å‡ ä½•ä½“ï¼ˆGeometryï¼‰å’Œæè´¨ï¼ˆMaterialï¼‰çš„ä¿¡æ¯ã€‚
>
> åœ¨ Three.js ä¸­ï¼Œ`Geometry` å¯¹è±¡æ˜¯ç‹¬ç«‹çš„ï¼Œç”¨äºæè¿°å’Œå­˜å‚¨å‡ ä½•ä½“çš„é¡¶ç‚¹ã€é¢å’Œå…¶ä»–å‡ ä½•æ•°æ®ã€‚è€Œåœ¨ Babylon.js ä¸­ï¼Œå‡ ä½•ä½“çš„ä¿¡æ¯æ˜¯ç›´æ¥ä¸ `Mesh` å¯¹è±¡å…³è”çš„ï¼Œè€Œä¸æ˜¯ä½œä¸ºç‹¬ç«‹çš„ `Geometry` å¯¹è±¡å­˜åœ¨ã€‚
>
> åœ¨ Three.js ä¸­ï¼Œ`Geometry` å¯¹è±¡çš„ç‹¬ç«‹æ€§å¸¦æ¥äº†ä¸€äº›å¥½å¤„ï¼š
>
> 1. å¯é‡ç”¨æ€§ï¼šç”±äº `Geometry` å¯¹è±¡æ˜¯ç‹¬ç«‹çš„ï¼Œä½ å¯ä»¥åœ¨å¤šä¸ª `Mesh` å¯¹è±¡ä¹‹é—´å…±äº«åŒä¸€ä¸ªå‡ ä½•ä½“ã€‚è¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜å’Œèµ„æºï¼Œé¿å…é‡å¤åˆ›å»ºå’Œå­˜å‚¨ç›¸åŒçš„å‡ ä½•æ•°æ®ã€‚
> 2. çµæ´»æ€§ï¼šä½ å¯ä»¥å¯¹ `Geometry` å¯¹è±¡è¿›è¡Œç‹¬ç«‹çš„æ“ä½œå’Œä¿®æ”¹ï¼Œè€Œä¸ä¼šå½±å“ä½¿ç”¨è¯¥å‡ ä½•ä½“çš„æ‰€æœ‰ `Mesh` å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„ `Mesh` å¯¹è±¡ä¸Šåº”ç”¨ä¸åŒçš„æè´¨ã€å˜æ¢æˆ–åŠ¨ç”»ï¼ŒåŒæ—¶å…±äº«ç›¸åŒçš„å‡ ä½•ä½“ã€‚
> 3. æ‰©å±•æ€§ï¼šé€šè¿‡ç»§æ‰¿ `Geometry` å¯¹è±¡ï¼Œä½ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„å‡ ä½•ä½“ï¼Œå¹¶æ·»åŠ é¢å¤–çš„å±æ€§å’Œæ–¹æ³•ã€‚è¿™æ ·å¯ä»¥æ»¡è¶³ç‰¹å®šçš„éœ€æ±‚ï¼Œå®ç°æ›´å¤æ‚å’Œç‰¹æ®Šçš„å‡ ä½•å½¢çŠ¶ã€‚
>
> å°½ç®¡ç‹¬ç«‹çš„ `Geometry` å¯¹è±¡åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šå ç”¨æ›´å¤šçš„å†…å­˜å’Œèµ„æºï¼Œä½†å®ƒä»¬æä¾›äº†æ›´å¤šçš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚è¿™å¯¹äºå¤æ‚çš„åœºæ™¯å’Œç‰¹æ®Šçš„å‡ ä½•éœ€æ±‚éå¸¸æœ‰ç”¨ã€‚
>
> è¯·æ³¨æ„ï¼Œåœ¨ Three.js r125 ç‰ˆæœ¬ä¹‹åï¼Œæ¨èä½¿ç”¨ `BufferGeometry` å¯¹è±¡ä»£æ›¿ `Geometry` å¯¹è±¡ï¼Œå› ä¸º `BufferGeometry` å¯¹è±¡åœ¨æ€§èƒ½ä¸Šæ›´é«˜æ•ˆã€‚

## Meshç»„åˆ

è¿™é‡Œåˆ†åˆ«å¯¼å…¥èœœèœ‚å’Œé¸­å­2ä¸ªå¤–éƒ¨æ¨¡å‹ï¼Œå°†ä»–ä»¬ç»„åˆåœ¨ä¸€èµ·ï¼Œå…¶ä¸­èœœèœ‚åœ¨é¸­å­çš„ä¸Šæ–¹ï¼ˆç›¸å¯¹ï¼‰ï¼Œä»–ä»¬ä¸€èµ·å›´ç€Yè½´æ—‹è½¬ï¼Œå¦å¤–èœœèœ‚æ¯2ç§’ä¸‹è½ä¸Šå‡ä¸€æ¬¡

> æ³¨æ„å¤–éƒ¨å¯¼å…¥çš„æ¨¡å‹ï¼Œè¦é€šè¿‡`bee.rotationQuaternion = null;`ç§»é™¤ä¹‹å‰çš„å››å…ƒæ•°æ—‹è½¬ï¼Œå¦åˆ™æ— æ³•æ—‹è½¬ã€‚
>
> åœ¨è®¸å¤š3Då›¾å½¢åº“å’Œå¼•æ“ä¸­ï¼Œé€šè¿‡å››å…ƒæ•°ï¼ˆQuaternionï¼‰æ¥è¡¨ç¤ºç‰©ä½“çš„æ—‹è½¬ã€‚å››å…ƒæ•°æ˜¯ä¸€ç§æ•°å­¦å·¥å…·ï¼Œç”¨äºè¡¨ç¤ºæ—‹è½¬çš„æ–¹å‘å’Œè§’åº¦ã€‚é€šè¿‡è®¾ç½®ç‰©ä½“çš„ rotationQuaternion å±æ€§ï¼Œå¯ä»¥å°†å…¶æ—‹è½¬åˆ°æŒ‡å®šçš„è§’åº¦ã€‚
>
> åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå°† rotationQuaternion è®¾ç½®ä¸º nullï¼Œæ„å‘³ç€å°†ç‰©ä½“çš„æ—‹è½¬é‡ç½®ä¸ºé»˜è®¤å€¼ï¼Œå³æ²¡æœ‰ä»»ä½•æ—‹è½¬ã€‚è¿™å°†ç§»é™¤ä¹‹å‰è®¾ç½®çš„ä»»ä½•æ—‹è½¬æ•ˆæœã€‚

ğŸ¤–æ¥çœ‹çœ‹ä¾‹å­çš„å®Œæ•´ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¯¼å…¥Duck.glbå’ŒBee.glbæ¨¡å‹å¹¶æ—‹è½¬</title>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
    <style>
      * {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      #renderCanvas {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <canvas id="renderCanvas"></canvas>

    <script>
      // åˆ›å»ºå¼•æ“
      var canvas = document.getElementById('renderCanvas')
      var engine = new BABYLON.Engine(canvas, true)

      // åˆ›å»ºåœºæ™¯
      var scene = new BABYLON.Scene(engine)

      // åˆ›å»ºç›¸æœº
      var camera = new BABYLON.ArcRotateCamera('camera', Math.PI / 2, Math.PI / 2, 2, BABYLON.Vector3.Zero(), scene)
      camera.attachControl(canvas, true)

      // åˆ›å»ºç¯å…‰
      var light = new BABYLON.HemisphericLight('light', new BABYLON.Vector3(0, 1, 0), scene)

      // åŠ è½½Duck.glbæ¨¡å‹
      BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Duck.glb', scene, function (meshes) {
        var duck = meshes[0]
        duck.rotationQuaternion = null // ç§»é™¤ä¹‹å‰çš„å››å…ƒæ•°æ—‹è½¬
        duck.rotation.y = Math.PI / 2 // è®¾ç½®åˆå§‹æ—‹è½¬è§’åº¦

        // åŠ è½½Bee.glbæ¨¡å‹
        BABYLON.SceneLoader.ImportMesh('', 'https://agents.uue.cn/courses/Web-3D/assets/models/', 'Bee-compressed.glb', scene, function (meshes) {
          var bee = meshes[0]
          bee.rotationQuaternion = null // ç§»é™¤ä¹‹å‰çš„å››å…ƒæ•°æ—‹è½¬
          bee.position.y = 3 // è®¾ç½®beeæ¨¡å‹çš„ç›¸å¯¹ä½ç½®
          bee.scaling = new BABYLON.Vector3(0.1, 0.1, 0.1) // ç¼©å°10å€

          // åˆ›å»ºçˆ¶èŠ‚ç‚¹
          var parentNode = new BABYLON.TransformNode('parentNode')
          duck.parent = parentNode
          bee.parent = parentNode

          // å®šä¹‰åŠ¨ç”»å‡½æ•°
          function animateBee() {
            bee.position.y = 1 // ä¸‹è½åˆ°1ï¼Œpositionçš„æ”¹å˜æ˜¯ç›¸å¯¹çˆ¶èŠ‚ç‚¹çš„æ”¹å˜
            setTimeout(function () {
              bee.position.y = 3 // ä¸Šå‡åˆ°3ï¼Œpositionçš„æ”¹å˜æ˜¯ç›¸å¯¹çˆ¶èŠ‚ç‚¹çš„æ”¹å˜
            }, 3000)
          }

          // è°ƒç”¨åŠ¨ç”»å‡½æ•°ï¼Œæ¯éš”2ç§’æ‰§è¡Œä¸€æ¬¡
          setInterval(animateBee, 2000)

          // æ¸²æŸ“å¾ªç¯
          engine.runRenderLoop(function () {
            parentNode.rotation.y += engine.getDeltaTime() / 1000 // æ¯ç§’æ—‹è½¬2å¼§åº¦
            scene.render()
          })
        })
      })

      // çª—å£è°ƒæ•´å¤„ç†
      window.addEventListener('resize', function () {
        engine.resize()
      })
    </script>
  </body>
</html>
```

![image-20231209125853176](Babylon.js.assets/image-20231209125853176.png)

## æ€§èƒ½ä¼˜åŒ–å’Œè°ƒè¯•

è¦ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½å’Œå¸§ç‡ï¼Œä½ å¯ä»¥å°è¯•ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ï¼š

1. å‡å°‘æ¸²æŸ“çš„å¯¹è±¡æ•°é‡ï¼šåªæ¸²æŸ“å½“å‰è§†é‡å†…çš„å¯¹è±¡ï¼Œå¹¶ç§»é™¤ä¸å¯è§çš„å¯¹è±¡ã€‚ä½ å¯ä»¥ä½¿ç”¨è§†é”¥ä½“å‰ªè£æˆ–è€…ä½¿ç”¨ frustum culling æŠ€æœ¯æ¥å®ç°ã€‚
2. åˆå¹¶å‡ ä½•ä½“ï¼šå¦‚æœä½ æœ‰è®¸å¤šé‡å çš„å°å‡ ä½•ä½“ï¼Œå¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå¤§å‡ ä½•ä½“ï¼Œå‡å°‘æ¸²æŸ“è°ƒç”¨çš„æ¬¡æ•°ã€‚
3. ä½¿ç”¨ LODï¼ˆLevel of Detailï¼‰æŠ€æœ¯ï¼šæ ¹æ®å¯¹è±¡è·ç¦»ç›¸æœºçš„è·ç¦»ï¼Œä½¿ç”¨ä¸åŒçš„ç»†èŠ‚çº§åˆ«æ¥æ¸²æŸ“ã€‚å½“å¯¹è±¡è¿œç¦»ç›¸æœºæ—¶ï¼Œä½¿ç”¨è¾ƒä½çš„ç»†èŠ‚çº§åˆ«ï¼Œå‡å°‘ç»†èŠ‚å’Œå¤šè¾¹å½¢æ•°é‡ã€‚
4. ä¼˜åŒ–çº¹ç†ä½¿ç”¨ï¼šä½¿ç”¨çº¹ç†å‹ç¼©ã€çº¹ç†åˆå¹¶å’Œçº¹ç†åˆ†è¾¨ç‡ç¼©å°ç­‰æŠ€æœ¯ï¼Œå‡å°‘çº¹ç†å†…å­˜å ç”¨å’ŒåŠ è½½æ—¶é—´ã€‚
5. ä½¿ç”¨ GPU å®ä¾‹åŒ–ï¼šå¦‚æœä½ æœ‰å¤§é‡ç›¸ä¼¼çš„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ GPU å®ä¾‹åŒ–æŠ€æœ¯æ¥å¤ç”¨å‡ ä½•ä½“å’Œç€è‰²å™¨ï¼Œå‡å°‘æ¸²æŸ“è°ƒç”¨çš„æ¬¡æ•°ã€‚
6. ä½¿ç”¨å»¶è¿Ÿæ¸²æŸ“ï¼šå°†ä¸€äº›å¼€é”€è¾ƒå¤§çš„æ¸²æŸ“æ“ä½œæ¨è¿Ÿåˆ°åç»­å¸§ä¸­è¿›è¡Œï¼Œä»¥ä¿æŒå®æ—¶æ¸²æŸ“çš„å¸§ç‡ç¨³å®šã€‚
7. é¿å…æ¯å¸§åˆ›å»ºå’Œé”€æ¯å¯¹è±¡ï¼šå¦‚æœæœ‰å¯èƒ½ï¼Œå°½é‡é‡ç”¨å·²æœ‰çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯æ¯å¸§éƒ½æ–°å»ºå¯¹è±¡æˆ–é”€æ¯å¯¹è±¡ï¼Œä»¥å‡å°‘

å‚è€ƒæ–‡æ¡£

* [Babylon.jså¤§è§„æ¨¡åœºæ™¯ä¼˜åŒ–å®æˆ˜ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/629581079)
